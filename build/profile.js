!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).milo=t()}(this,function(){function e(e,t){return t||(t=e.slice(0)),e.raw=t,e}function t(e){var t=[].slice.call(arguments,1),n=e.reduce(function(e,n,a){return t[a]instanceof HTMLElement?e+n+'<elem ref="'+a+'"></elem>':e+n+(t[a]||"")},""),a=document.createRange().createContextualFragment(n).children[0];return Array.prototype.map.call(a.querySelectorAll("elem"),function(e){var n=e.getAttribute("ref");e.replaceWith(t[n])}),a}var n,a,o,i="is-open",r=document.querySelector(".gnav-curtain"),s=function(){var e=this;this.toggleOnSpace=function(t){if("Space"===t.code){t.preventDefault();var n=t.target.closest(".has-menu");e.toggleMenu(n)}},this.closeOnScroll=function(){var t;t||(e.state.openMenu&&e.toggleMenu(e.state.openMenu),t=!0,document.removeEventListener("scroll",e.closeOnScroll))},this.toggleMenu=function(t){var n=t.classList.contains("feds-search"),a=t===e.state.openMenu;e.state.openMenu&&e.closeMenu(),a||e.openMenu(t,n)},this.closeOnEscape=function(t){"Escape"===t.code&&e.toggleMenu(e.state.openMenu)},this.closeOnDocClick=function(t){var n=t.target.closest(".is-open"),a=t.target===r;(e.state.openMenu&&!n||a)&&e.toggleMenu(e.state.openMenu),a&&r.classList.remove("is-open")},this.openMenu=function(t,n){t.classList.add(i);var a=t.querySelector("[aria-expanded]");a.setAttribute("aria-expanded",!0),a.setAttribute("daa-lh","header|Close"),document.addEventListener("click",e.closeOnDocClick),window.addEventListener("keydown",e.closeOnEscape),n?(r.classList.add("is-open"),t.querySelector(".feds-search-input")&&t.querySelector(".feds-search-input").focus()):window.matchMedia("(min-width: 900px)").matches&&(document.addEventListener("scroll",e.closeOnScroll,{passive:!0}),t.classList.contains("large-menu")&&r.classList.add("is-open","is-quiet")),e.state.openMenu=t},this.closeMenu=function(){e.state.openMenu.classList.remove(i),r.classList.remove("is-open"),r.classList.remove("is-quiet"),document.removeEventListener("click",e.closeOnDocClick),window.removeEventListener("keydown",e.closeOnEscape);var t=e.state.openMenu.querySelector("[aria-expanded]");t.setAttribute("aria-expanded",!1),t.setAttribute("daa-lh","header|Open"),e.state.openMenu=null},this.state={}};"undefined"==typeof Symbol||Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"));var l,c,u,d,p,f,m=function(e,t){return e},h=function(a){return a?(a.href=m(a.href),t(n||(n=e(['<li class="gnav-profile-action">',"</li>"])),a)):""},g=/*#__PURE__*/function(){function n(e){var t=e.decoratedEl,n=e.avatarImgEl,a=e.toggleMenu,o=e.profileButtonEl,i=e.accountLinkEl,r=e.signOutEl,s=e.manageTeamsEl,l=e.manageEnterpriseEl;this.sections=e.sections,this.avatarImgEl=n,this.accountLinkEl=i,this.signOutEl=r,this.manageTeamsEl=s,this.manageEnterpriseEl=l,this.toggleMenu=a,this.profileButtonEl=o,this.decoratedEl=t,this.init()}var i=n.prototype;return i.init=function(){try{var e=this;return Promise.resolve(window.adobeIMS.getProfile()).then(function(t){var n=t.displayName,a=t.email;e.profileButtonEl&&e.profileButtonEl.setAttribute("aria-label",n),e.displayName=n,e.email=a,e.decoratedEl.append(e.menu()),e.decoratedEl.addEventListener("click",function(){return e.toggleMenu(e.decoratedEl)}),e.decoratedEl.dispatchEvent(new Event("profile_ready"))})}catch(e){return Promise.reject(e)}},i.decorateSignOut=function(){var n=t(a||(a=e(['<li class="gnav-profile-action">',"</li>"])),this.signOutEl);return n.addEventListener("click",function(e){e.preventDefault(),window.adobeIMS.signOut()}),n},i.menu=function(){var n,a,i,r,s,l,c;return t(o||(o=e(['\n      <div id="gnav-profile-menu" class="gnav-profile-menu">\n        <a \n          href="','" \n          class="gnav-profile-header"\n          aria-label="','"\n        >\n          ','\n          <div class="gnav-profile-details">\n            <p class="gnav-profile-name">','</p>\n            <p class="gnav-profile-email">','</p>\n            <p class="gnav-profile-account">','</p>\n          </div>\n        </a>\n        <ul class="gnav-profile-actions">\n          ',"\n          ","\n          ","\n        </ul>\n      </div>\n    "])),m(this.accountLinkEl.href),this.accountLinkEl.textContent,this.avatarImgEl.cloneNode(!0),this.displayName,(r=(i=this.email.split("@"))[0].length<=12?i[0]:i[0].slice(0,12)+"…",l=(s=i[1].split(".")).pop(),r+"@"+(c=(c=s.join(".")).length<=12?c:c.slice(0,12)+"…")+"."+l),this.accountLinkEl.innerHTML,null!=(n=this.sections.manage.items.team)&&n.id?h(this.manageTeamsEl):"",null!=(a=this.sections.manage.items.enterprise)&&a.id?h(this.manageEnterpriseEl):"",this.decorateSignOut())},n}(),v=function(e){return new Promise(function(t){var n,a,o;n="https://www.adobe.com/"+e,a=t,(o=document.head.querySelector('link[href="'+n+'"]'))?a&&a("noop"):((o=document.createElement("link")).setAttribute("rel","stylesheet"),o.setAttribute("href",n),a&&(o.onload=function(e){return a(e.type)},o.onerror=function(e){return a(e.type)}),document.head.appendChild(o))})},E=function(n){var a=n.target;try{var o=window.adobeIMS.getAccessToken();return Promise.resolve(v("libs/styles/variables.css")).then(function(){return Promise.resolve(v("libs/blocks/global-navigation/blocks/profile/profile.css")).then(function(){return Promise.resolve(v("libs/blocks/global-navigation/blocks/profile/profile-wrapper.css")).then(function(){function n(n){return Promise.resolve(n.json()).then(function(n){var o=n.sections,i=n.user.avatar,r=t(l||(l=e(['<img class="gnav-profile-img" src="','"></img>'])),i),m=t(c||(c=e(['<a href="https://account.adobe.com/">Sign Out</a>']))),h=t(u||(u=e(['<a href="https://adminconsole.adobe.com/team">Manage Team</a>']))),v=t(d||(d=e(['<a href="https://adminconsole.adobe.com/">Manage Enterprise</a>']))),E=t(p||(p=e(['<a href="https://account.adobe.com/">View Account</a>']))),b=t(f||(f=e(['\n  <div class="gnav-profile">\n    <button class="gnav-profile-button" aria-expanded="false" aria-controls="gnav-profile-menu" aria-label="Profile button"> \n      ',"\n    </button>\n  </div>\n"])),r),M=new g({toggleMenu:(new s).toggleMenu,avatarImgEl:r,sections:o,accountLinkEl:E,decoratedEl:b,signOutEl:m,manageTeamsEl:h,manageEnterpriseEl:v});return a.parentNode.replaceChild(b,a),M})}return o?Promise.resolve(fetch("https://cc-collab-stage.adobe.io/profile",{headers:new Headers({Authorization:"Bearer "+o.token})})).then(n):n({})})})})}catch(e){return Promise.reject(e)}};return window.adobeProfile=E,E});
