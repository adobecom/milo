name: Merge to stage

on:
  schedule:
    - cron: '0 * * * *' # Run every hour
  workflow_dispatch: # Allow manual trigger
  pull_request:
    types: [labeled] # Run when a label is added to a PR

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4.1.1

      - name: Check label
        id: check_label
        uses: actions/github-script@v7.0.1
        with:
          script: |
            const { label: { name } } = JSON.parse(process.env.GITHUB_EVENT_PATH);
            return name === 'ready-for-stage';
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Remind PR initiators
        uses: actions/github-script@v7.0.1
        with:
          script: |
            const main = require('./.github/workflows/merge-to-stage.js')
            main({ github, context })
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
