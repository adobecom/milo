<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Merch Card Product variant test page</title>
        <link
            rel="stylesheet"
            href="http://localhost:2023/__wds-outside-root__/2/styles/styles.css"
        />
        <script>
            window.process = {
                env: {},
            };
        </script>
        <style>
            main {
                display: flex;
                align-items: center;
                gap: 20px;
                flex-direction: column;
                padding-top: 80px;
                min-width: 1200px;
            }

            main > div {
                display: initial;
            }

            #sidenav {
                display: none;
            }

            @media screen and (min-width: 1440px) {
                #sidenav {
                    flex: 1;
                    justify-content: stretch;
                    padding-top: 8px;
                    display: flex;
                    position: fixed;
                    bottom: 0px;
                    left: 0px;
                    gap: 20px;
                    flex-direction: column;
                    width: 220px;
                }
            }

            #firstcards {
                background: linear-gradient(
                    90deg,
                    rgba(2, 0, 36, 1) 0%,
                    rgba(140, 43, 95, 0.4430147058823529) 35%,
                    rgba(0, 212, 255, 1) 100%
                );
            }

            mas-commerce-service {
                display: none;
            }
        </style>
    </head>

    <body>
        <mas-commerce-service env="stage"></mas-commerce-service>
        <main>
            <div class="three-merch-cards product"></div>
        </main>

        <template id="acrobat-teams-cards">
            <merch-card
                class="merch-card product secure has-divider"
                variant="product"
                size=""
                secure-label="Secure transaction"
                filters="all"
                types=""
                custom-hr="true"
                tabindex="0"
            >
                <h3
                    id="acrobat-standard-for-teams"
                    class="card-heading"
                    slot="heading-xs"
                >
                    Acrobat Standard for teams
                </h3>
                <h4
                    id="price---abm---acrobat-standard-dc"
                    class="card-heading"
                    slot="heading-xs"
                >
                    <strong
                        ><span
                            is="inline-price"
                            data-display-old-price="true"
                            data-display-per-unit="true"
                            data-quantity="1"
                            data-template="price"
                            data-wcs-osi="abm"
                        ></span
                    ></strong>
                </h4>
                <h5
                    id="annual-subscription-cancel-within-14-days-for-a-full-refund-fee-applies-if-you-cancel-after-14-days-info"
                    class="card-heading"
                    slot="body-xxs"
                >
                    <em
                        >Annual subscription, cancel within 14 days for a
                        <a
                            href="https://helpx.adobe.com/manage-account/using/cancel-subscription.html"
                            daa-ll="full refund-1--Acrobat Standard for"
                            >full refund</a
                        >. Fee applies if you cancel after 14 days.<span
                            class="icon icon-info margin-inline-start"
                        ></span
                    ></em>
                </h5>
                <div slot="callout-content">
                    <div>
                        <div>
                            <div>
                                AI Assistant add-on available for
                                <strong>US$4.99/mo.</strong> Early access
                                pricing extended to September 4, 2024.<span
                                    class="icon icon-info margin-inline-start"
                                ></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div slot="body-xs">
                    <p>
                        <br />Simple PDF app with capabilities to edit, convert,
                        and e-sign.
                    </p>
                </div>
                <div slot="body-lower">
                    <hr style="background: rgb(232, 232, 232); width: 100%" />
                    <merch-quantity-select
                        title="Number of licenses"
                        min="2"
                        max="10"
                        step="1"
                        default-value="undefined"
                        max-input="undefined"
                        closed=""
                    ></merch-quantity-select>
                </div>
                <div slot="footer">
                    <p class="action-area">
                        <a
                            is="checkout-link"
                            data-checkout-workflow="UCv3"
                            data-checkout-workflow-step="recommendation"
                            data-quantity="2"
                            data-wcs-osi="abm"
                            data-extra-options="{}"
                            daa-ll="Buy now-2--Acrobat Standard for"
                            ><span>Buy now</span></a
                        >
                    </p>
                </div>
            </merch-card>
            <merch-card
                class="merch-card product secure has-divider"
                variant="product"
                size=""
                secure-label="Secure transaction"
                filters="all"
                types=""
                custom-hr="true"
                tabindex="0"
            >
                <h3
                    id="acrobat-pro-for-teams"
                    class="card-heading"
                    slot="heading-xs"
                >
                    Acrobat Pro for teams
                </h3>
                <h4
                    id="price---abm---acrobat-standard-dc"
                    class="card-heading"
                    slot="heading-xs"
                >
                    <strong
                        ><span
                            is="inline-price"
                            data-display-old-price="true"
                            data-display-per-unit="true"
                            data-quantity="1"
                            data-template="price"
                            data-wcs-osi="abm"
                        ></span
                    ></strong>
                </h4>
                <h5
                    id="annual-subscription-cancel-within-14-days-for-a-full-refund-fee-applies-if-you-cancel-after-14-days-info-1"
                    class="card-heading"
                    slot="body-xxs"
                >
                    <em
                        >Annual subscription, cancel within 14 days for a
                        <a
                            href="https://helpx.adobe.com/manage-account/using/cancel-subscription.html"
                            daa-ll="full refund-1--Acrobat Pro for team"
                            >full refund</a
                        >. Fee applies if you cancel after 14 days.<span
                            class="icon icon-info margin-inline-start"
                        ></span
                    ></em>
                </h5>
                <div slot="callout-content">
                    <div>
                        <div>
                            <div>
                                AI Assistant add-on available for
                                <strong>US$4.99/mo.</strong> Early access
                                pricing extended to September 4, 2024.<span
                                    class="icon icon-info margin-inline-start"
                                ></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div slot="body-xs">
                    <p>
                        <br />Essential PDF solution with full conversion and
                        editing capabilities, advanced e-sign features, and
                        more.
                    </p>
                </div>
                <div slot="body-lower">
                    <hr style="background: rgb(232, 232, 232); width: 100%" />
                    <merch-quantity-select
                        title="Number of licenses"
                        min="2"
                        max="10"
                        step="1"
                        default-value="undefined"
                        max-input="undefined"
                        closed=""
                    ></merch-quantity-select>
                </div>
                <div slot="footer">
                    <p class="action-area">
                        <a
                            is="checkout-link"
                            data-checkout-workflow="UCv3"
                            data-checkout-workflow-step="recommendation"
                            data-quantity="2"
                            data-wcs-osi="abm"
                            data-extra-options="{}"
                            daa-ll="Buy now-2--Acrobat Standard for"
                            ><span>Buy now</span></a
                        >
                    </p>
                </div>
            </merch-card>
            <merch-card
                class="merch-card product secure badge-card has-divider"
                variant="product"
                size=""
                badge-background-color="#EDCC2D"
                badge-color="#000000"
                badge-text="Save 7.5%"
                secure-label="Secure transaction"
                filters="all"
                types=""
                custom-hr="true"
                tabindex="0"
                style="border: 1px solid rgb(237, 204, 45)"
            >
                <h3
                    id="acrobat-pro-for-teams-5-pack"
                    class="card-heading"
                    slot="heading-xs"
                >
                    Acrobat Pro for teams 5-pack
                </h3>
                <h4
                    id="price---abm---acrobat-standard-dc"
                    class="card-heading"
                    slot="heading-xs"
                >
                    <strong
                        ><span
                            is="inline-price"
                            data-display-old-price="true"
                            data-display-per-unit="true"
                            data-quantity="1"
                            data-template="price"
                            data-wcs-osi="abm"
                        ></span
                    ></strong>
                </h4>
                <h5
                    id="annual-subscription-paid-monthly-cancel-within-14-days-for-a-full-refund-fee-applies-if-you-cancel-after-14-days-minimum-of-5-licenses-first-year-only-see-terms-info"
                    class="card-heading"
                    slot="body-xxs"
                >
                    <em
                        >Annual subscription, paid monthly. Cancel within 14
                        days for a full refund. Fee applies if you cancel after
                        14 days. Minimum of 5 licenses. First year only.
                        <a
                            href="https://www.adobe.com/acrobat/pricing/business.html#5-pack-terms"
                            daa-ll="See terms-1--Acrobat Pro for team"
                            >See terms</a
                        >.<span
                            class="icon icon-info margin-inline-start"
                        ></span
                    ></em>
                </h5>
                <div slot="callout-content">
                    <div>
                        <div>
                            <div>
                                AI Assistant add-on available for
                                <strong>US$4.99/mo.</strong> Early access
                                pricing extended to September 4, 2024. I am the
                                bigger string<span
                                    class="icon icon-info margin-inline-start"
                                ></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div slot="body-xs">
                    <p>
                        <br />Essential PDF solution with full convert and edit
                        capabilities, advanced e-sign features, and more.
                    </p>
                </div>
                <div slot="body-lower">
                    <hr style="background: rgb(232, 232, 232); width: 100%" />
                    <merch-quantity-select
                        title="Number of licenses"
                        min="2"
                        max="10"
                        step="1"
                        default-value="undefined"
                        max-input="undefined"
                        closed=""
                    ></merch-quantity-select>
                </div>
                <div slot="footer">
                    <span class="secure-transaction-label"
                        >Secure transaction</span
                    >
                    <p class="action-area">
                        <a
                            is="checkout-link"
                            data-checkout-workflow="UCv3"
                            data-checkout-workflow-step="commitment"
                            data-quantity="1"
                            data-wcs-osi="abm"
                            data-extra-options="{}"
                            class="con-button"
                            daa-ll="Free trial-4--Creative Cloud All Apps"
                            ><span>Free trial</span></a
                        >
                        <a
                            is="checkout-link"
                            data-checkout-workflow="UCv3"
                            class="con-button"
                            data-checkout-workflow-step="recommendation"
                            data-quantity="2"
                            data-wcs-osi="abm"
                            data-extra-options="{}"
                            daa-ll="Buy now-2--Acrobat Standard for"
                            ><span>Buy now</span></a
                        >
                    </p>
                </div>
            </merch-card>
        </template>

        <template id="acrobat-cci-cards">
            <merch-card
                class="merch-card product secure has-divider"
                variant="product"
                secure-label="Secure transaction"
            >
                <h3
                    id="acrobat-standard"
                    class="card-heading"
                    slot="heading-xs"
                >
                    Acrobat Standard
                </h3>
                <p class="card-heading" slot="heading-xs">
                    <strong
                        ><span
                            is="inline-price"
                            data-display-old-price="true"
                            data-display-per-unit="false"
                            data-quantity="1"
                            data-template="price"
                            data-wcs-osi="QgYu51CVY2wKyFEqMuvec4N1tc1OaCypeKJjT5n2-Fc"
                        ></span>
                    </strong>
                </p>
                <p class="card-heading" slot="body-xxs">
                    <em
                        >Annual, billed monthly, cancel within 14 days for a
                        <a
                            href="https://helpx.adobe.com/manage-account/using/cancel-subscription.html"
                            daa-ll="full refund-1--Acrobat Standard"
                            >full refund</a
                        >. Fee applies if you cancel after 14 days.</em
                    >
                    <span
                        class="icon icon-info milo-tooltip right margin-inline-start"
                        data-tooltip="If you cancel after 14 days, your service will continue until the end of that month’s billing period, and you will be charged an early termination fee."
                        tabindex="0"
                        aria-label="If you cancel after 14 days, your service will continue until the end of that month’s billing period, and you will be charged an early termination fee."
                        role="button"
                        ><svg
                            id="info"
                            viewBox="0 0 18 18"
                            class="icon-milo icon-milo-info"
                        >
                            <path
                                fill="currentcolor"
                                d="M10.075,6A1.075,1.075,0,1,1,9,4.925H9A1.075,1.075,0,0,1,10.075,6Zm.09173,6H10V8.2A.20005.20005,0,0,0,9.8,8H7.83324S7.25,8.01612,7.25,8.5c0,.48365.58325.5.58325.5H8v3H7.83325s-.58325.01612-.58325.5c0,.48365.58325.5.58325.5h2.3335s.58325-.01635.58325-.5C10.75,12.01612,10.16673,12,10.16673,12ZM9,.5A8.5,8.5,0,1,0,17.5,9,8.5,8.5,0,0,0,9,.5ZM9,15.6748A6.67481,6.67481,0,1,1,15.67484,9,6.67481,6.67481,0,0,1,9,15.6748Z"
                            ></path></svg
                    ></span>
                </p>
                <div slot="body-xs">
                    <p>
                        Simple PDF tools for editing and converting documents.
                    </p>
                </div>
                <merch-addon slot="addon">
                    <p><strong>Acrobat AI Assistant</strong></p>
                    <p data-plan-type="">
                        Add AI Assistant to your free Reader app for
                        <strong>
                            <span
                                is="inline-price"
                                data-template="price"
                                data-wcs-osi="puf"
                            ></span
                        ></strong>
                    </p>
                    <p data-plan-type="">
                        Add AI Assistant to your free Reader app for
                        <strong>
                            <span
                                is="inline-price"
                                data-template="price"
                                data-wcs-osi="abm"
                            ></span
                        ></strong>
                    </p>
                    <p data-plan-type="">
                        Add AI Assistant to your free Reader app for
                        <strong>
                            <span
                                is="inline-price"
                                data-template="price"
                                data-wcs-osi="m2m"
                            ></span
                        ></strong>
                    </p>
                    <merch-gradient
                        colors="#F5F6FD, #F8F1F8, #F9E9ED"
                        positions="33.52%, 67.33%, 110.37%"
                        angle="211deg"
                        border-radius="10px"
                    ></merch-gradient>
                </merch-addon>
                <div slot="footer">
                    <p class="action-area">
                        <a
                            is="checkout-link"
                            data-checkout-workflow="UCv3"
                            data-checkout-workflow-step="email"
                            data-quantity="1"
                            data-wcs-osi="QgYu51CVY2wKyFEqMuvec4N1tc1OaCypeKJjT5n2-Fc"
                            data-extra-options="{}"
                            class="con-button blue"
                            >Buy now</a
                        >
                    </p>
                </div>
                <div slot="body-lower"><hr style="background: #e8e8e8" /></div
            ></merch-card>
        </template>
        <template id="acrobat-free">
            <merch-card
                class="merch-card product secure has-divider"
                variant="product"
                secure-label="Secure transaction"
                plan-type="PUF"
            >
                <h3
                    id="acrobat-standard"
                    class="card-heading"
                    slot="heading-xs"
                >
                    Acrobat Reader
                </h3>
                <p class="card-heading" slot="heading-xs">Free</p>
                <div slot="body-xs">
                    <p>
                        Simple PDF tools for editing and converting documents.
                    </p>
                </div>
                <merch-addon slot="addon">
                    <p><strong>Acrobat AI Assistant</strong></p>
                    <p data-plan-type="">
                        Add AI Assistant to your free Reader app for
                        <strong>
                            <span
                                is="inline-price"
                                data-template="price"
                                data-wcs-osi="puf"
                            ></span
                        ></strong>
                    </p>
                    <p data-plan-type="">
                        Add AI Assistant to your free Reader app for
                        <strong>
                            <span
                                is="inline-price"
                                data-template="price"
                                data-wcs-osi="abm"
                            ></span
                        ></strong>
                    </p>
                    <p data-plan-type="">
                        Add AI Assistant to your free Reader app for
                        <strong>
                            <span
                                is="inline-price"
                                data-template="price"
                                data-wcs-osi="m2m"
                            ></span
                        ></strong>
                    </p>
                    <merch-gradient
                        colors="#F5F6FD, #F8F1F8, #F9E9ED"
                        positions="33.52%, 67.33%, 110.37%"
                        angle="211deg"
                        border-radius="10px"
                    ></merch-gradient>
                </merch-addon>
                <div slot="footer">
                    <p class="action-area">
                        <a
                            is="checkout-link"
                            data-checkout-workflow="UCv3"
                            data-checkout-workflow-step="email"
                            data-quantity="1"
                            data-wcs-osi="QgYu51CVY2wKyFEqMuvec4N1tc1OaCypeKJjT5n2-Fc"
                            data-extra-options="{}"
                            class="con-button blue"
                            >Buy now</a
                        >
                    </p>
                </div>
                <div slot="body-lower"><hr style="background: #e8e8e8" /></div
            ></merch-card>
        </template>

        <script type="module">
            import { runTests } from '@web/test-runner-mocha';
            import { expect } from '@esm-bundle/chai';
            import { mockFetch } from './mocks/fetch.js';
            import { mockIms } from './mocks/ims.js';
            import { mockLana } from './mocks/lana.js';
            import { withWcs } from './mocks/wcs.js';
            import {
                delay,
                getTemplateContent,
                toggleLargeDesktop,
            } from './utils.js';
            import '../src/merch-offer.js';
            import '../src/merch-offer-select.js';
            import '../src/merch-quantity-select.js';
            import '../src/mas.js';

            runTests(async () => {
                mockIms();
                mockLana();
                await mockFetch(withWcs);
                await toggleLargeDesktop();
                const container = document.querySelector('main > div');

                describe('merch-card web component with product variant', () => {
                    it('product should have same body slot heights', async () => {
                        const [standard, pro, pro5Pack] = getTemplateContent(
                            'acrobat-teams-cards',
                        );

                        container.append(standard, pro, pro5Pack);

                        const products = [
                            ...document.querySelectorAll(
                                'merch-card[variant="product"]',
                            ),
                        ];
                        await Promise.all(
                            products.map((card) => card.checkReady),
                        );
                        products.forEach((card) => card.requestUpdate());
                        await delay(100);

                        const [card1Slots, card2Slots, card3Slots] = [
                            ...products,
                        ].map((product) => {
                            const heights = [
                                'slot[name="heading-xs"]',
                                'slot[name="body-xxs"]',
                                'slot[name="body-xs"]',
                                'slot[name="callout-content"]',
                                'slot[name="body-lower"]',
                            ]
                                .map((selector) => {
                                    const el =
                                        product.shadowRoot.querySelector(
                                            selector,
                                        );
                                    if (!el) return 0;
                                    return parseInt(
                                        window.getComputedStyle(el).height,
                                    );
                                })
                                .join(',');
                            return heights;
                        });
                        expect(card1Slots).to.not.contain('auto');
                        expect(card1Slots).to.equal(card2Slots);
                        expect(card2Slots).to.equal(card3Slots);
                    });

                    it('should support merch-addon', async () => {
                        const [standard] =
                            getTemplateContent('acrobat-cci-cards');

                        container.append(standard);
                        await standard.checkReady;
                    });

                    it('should change free text to addon price', async () => {
                        const [free] = getTemplateContent('acrobat-free');
                        container.append(free);
                        await free.checkReady;
                    });
                });
            });
        </script>
    </body>
</html>
