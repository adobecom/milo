{
  "version": 3,
  "sources": ["../../blocks/global-navigation/features/profile/dropdown.js"],
  "sourcesContent": ["import { getConfig } from '../../../../utils/utils.js';\nimport { toFragment, getFedsPlaceholderConfig, trigger, closeAllDropdowns, logErrorFor } from '../../utilities/utilities.js';\nimport { replaceKeyArray } from '../../../../features/placeholders.js';\n\nconst getLanguage = (ietfLocale) => {\n  if (!ietfLocale.length) return 'en';\n\n  const nonStandardLocaleMap = { 'no-NO': 'nb' };\n\n  if (nonStandardLocaleMap[ietfLocale]) {\n    return nonStandardLocaleMap[ietfLocale];\n  }\n\n  return ietfLocale.split('-')[0];\n};\n\nconst decorateProfileLink = (service, path = '') => {\n  const defaultServiceUrls = {\n    adminconsole: 'https://adminconsole.adobe.com',\n    account: 'https://account.adobe.com',\n  };\n\n  if (!service.length || !defaultServiceUrls[service]) return '';\n\n  let serviceUrl;\n  const { env } = getConfig();\n\n  if (!env?.[service]) {\n    serviceUrl = defaultServiceUrls[service];\n  } else {\n    serviceUrl = new URL(defaultServiceUrls[service]);\n    serviceUrl.hostname = env[service];\n  }\n\n  return `${serviceUrl}${path}`;\n};\n\nconst decorateAction = (label, path) => toFragment`<li><a class=\"feds-profile-action\" href=\"${decorateProfileLink('adminconsole', path)}\">${label}</a></li>`;\n\nclass ProfileDropdown {\n  constructor({\n    rawElem,\n    decoratedElem,\n    avatar,\n    sections,\n    buttonElem,\n    openOnInit,\n  } = {}) {\n    this.placeholders = {};\n    this.profileData = {};\n    this.avatar = avatar;\n    this.buttonElem = buttonElem;\n    this.decoratedElem = decoratedElem;\n    this.sections = sections;\n    this.openOnInit = openOnInit;\n    this.localMenu = rawElem.querySelector('h5')?.parentElement;\n    logErrorFor(this.init.bind(this), 'ProfileDropdown.init()', 'errorType=error,module=gnav-profile');\n  }\n\n  async init() {\n    await this.getData();\n    this.setButtonLabel();\n    this.dropdown = this.decorateDropdown();\n    this.addEventListeners();\n\n    if (this.openOnInit) trigger({ element: this.buttonElem });\n\n    this.decoratedElem.append(this.dropdown);\n  }\n\n  async getData() {\n    [\n      [\n        this.placeholders.profileButton,\n        this.placeholders.signOut,\n        this.placeholders.viewAccount,\n        this.placeholders.manageTeams,\n        this.placeholders.manageEnterprise,\n        this.placeholders.profileAvatar,\n      ],\n      { displayName: this.profileData.displayName, email: this.profileData.email },\n    ] = await Promise.all([\n      replaceKeyArray(\n        ['profile-button', 'sign-out', 'view-account', 'manage-teams', 'manage-enterprise', 'profile-avatar'],\n        getFedsPlaceholderConfig(),\n      ),\n      window.adobeIMS.getProfile(),\n    ]);\n  }\n\n  setButtonLabel() {\n    if (this.buttonElem) this.buttonElem.setAttribute('aria-label', this.profileData.displayName);\n  }\n\n  decorateDropdown() {\n    const { locale } = getConfig();\n    const lang = getLanguage(locale.ietf);\n\n    // TODO: the account name and email might need a bit of adaptive behavior;\n    // historically we shrunk the font size and displayed the account name on two lines;\n    // the email had some special logic as well;\n    // for MVP, we took a simpler approach (\"Some very long name, very l...\")\n    this.avatarElem = toFragment`<img\n      class=\"feds-profile-img\"\n      src=\"${this.avatar}\"\n      tabindex=\"0\"\n      alt=\"${this.placeholders.profileAvatar}\"\n      data-url=\"${decorateProfileLink('account', `profile?lang=${lang}`)}\"></img>`;\n    return toFragment`\n      <div id=\"feds-profile-menu\" class=\"feds-profile-menu\">\n        <a\n          href=\"${decorateProfileLink('account', `?lang=${lang}`)}\"\n          class=\"feds-profile-header\"\n          daa-ll=\"${this.placeholders.viewAccount}\"\n          aria-label=\"${this.placeholders.viewAccount}\"\n        >\n          ${this.avatarElem}\n          <div class=\"feds-profile-details\">\n            <p class=\"feds-profile-name\">${this.profileData.displayName}</p>\n            <p class=\"feds-profile-email\">${this.decorateEmail(this.profileData.email)}</p>\n            <p class=\"feds-profile-account\">${this.placeholders.viewAccount}</p>\n          </div>\n        </a>\n        ${this.localMenu ? this.decorateLocalMenu() : ''}\n        <ul class=\"feds-profile-actions\">\n          ${this.sections?.manage?.items?.team?.id ? decorateAction(this.placeholders.manageTeams, '/team') : ''}\n          ${this.sections?.manage?.items?.enterprise?.id ? decorateAction(this.placeholders.manageEnterprise) : ''}\n          ${this.decorateSignOut()}\n        </ul>\n      </div>\n    `;\n  }\n\n  decorateEmail() {\n    const maxCharacters = 12;\n    const emailParts = this.profileData.email.split('@');\n    const username = emailParts[0].length <= maxCharacters\n      ? emailParts[0]\n      : `${emailParts[0].slice(0, maxCharacters)}\u2026`;\n    const domainArr = emailParts[1].split('.');\n    const tld = domainArr.pop();\n    let domain = domainArr.join('.');\n    domain = domain.length <= maxCharacters\n      ? domain\n      : `${domain.slice(0, maxCharacters)}\u2026`;\n\n    return `${username}@${domain}.${tld}`;\n  }\n\n  decorateLocalMenu() {\n    if (this.localMenu) this.localMenu.classList.add('feds-local-menu');\n\n    return this.localMenu;\n  }\n\n  decorateSignOut() {\n    const signOutLink = toFragment`\n      <li>\n        <a href=\"#\" class=\"feds-profile-action\" daa-ll=\"${this.placeholders.signOut}\">${this.placeholders.signOut}</a>\n      </li>\n    `;\n\n    signOutLink.addEventListener('click', (e) => {\n      e.preventDefault();\n      window.dispatchEvent(new Event('feds:signOut'));\n      window.adobeIMS.signOut();\n    });\n\n    return signOutLink;\n  }\n\n  addEventListeners() {\n    this.buttonElem.addEventListener('click', (e) => trigger({ element: this.buttonElem, event: e }));\n    this.buttonElem.addEventListener('keydown', (e) => e.code === 'Escape' && closeAllDropdowns());\n    this.dropdown.addEventListener('keydown', (e) => e.code === 'Escape' && closeAllDropdowns());\n    this.avatarElem.addEventListener('click', (e) => {\n      e.preventDefault();\n      window.location.assign(this.avatarElem.dataset?.url);\n    });\n  }\n}\n\nexport default ProfileDropdown;\n"],
  "mappings": "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",
  "names": []
}
