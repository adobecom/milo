{
  "version": 3,
  "sources": ["../../features/georouting/georouting.js"],
  "sourcesContent": ["export const getCookie = (name) => document.cookie\n  .split('; ')\n  .find((row) => row.startsWith(`${name}=`))\n  ?.split('=')[1];\n\nconst geo2jsonp = (callback) => {\n  // Setup a unique name that can be called & destroyed\n  const callbackName = `jsonp_${Math.round(100000 * Math.random())}`;\n\n  const script = document.createElement('script');\n  script.src = `https://geo2.adobe.com/json/?callback=${callbackName}`;\n\n  // Define the function that the script will call\n  window[callbackName] = (data) => {\n    delete window[callbackName];\n    document.body.removeChild(script);\n    callback(data);\n  };\n\n  document.body.appendChild(script);\n};\n\nconst getAkamaiCode = () => new Promise((resolve) => {\n  const urlParams = new URLSearchParams(window.location.search);\n  const akamaiLocale = urlParams.get('akamaiLocale') || sessionStorage.getItem('akamai');\n  if (akamaiLocale !== null) {\n    resolve(akamaiLocale.toLowerCase());\n  } else {\n    geo2jsonp((data) => {\n      const code = data.country.toLowerCase();\n      sessionStorage.setItem('akamai', code);\n      resolve(code);\n    });\n  }\n});\n\n// Determine if any of the locales can be linked to.\nasync function getAvailableLocales(locales, config, getMetadata) {\n  const fallback = getMetadata('fallbackrouting') || config.fallbackRouting;\n\n  const { contentRoot } = config.locale;\n  const path = window.location.href.replace(contentRoot, '');\n\n  const availableLocales = [];\n  const pagesExist = [];\n  for (const [index, locale] of locales.entries()) {\n    const prefix = locale.prefix ? `/${locale.prefix}` : '';\n    const localeRoot = `${prefix}${config.contentRoot ?? ''}`;\n    const localePath = `${localeRoot}${path}`;\n\n    const pageExistsRequest = fetch(localePath, { method: 'HEAD' }).then((resp) => {\n      if (resp.ok) {\n        locale.url = localePath;\n        availableLocales[index] = locale;\n      } else if (fallback !== 'off') {\n        locale.url = `${localeRoot}/`;\n        availableLocales[index] = locale;\n      }\n    });\n    pagesExist.push(pageExistsRequest);\n  }\n  if (pagesExist.length > 0) await Promise.all(pagesExist);\n\n  return availableLocales.filter((a) => !!a);\n}\n\nfunction buildText(locales, config, createTag) {\n  const fragment = new DocumentFragment();\n  const wrapper = createTag('div', { class: 'text-wrapper' });\n  locales.forEach((locale) => {\n    const lang = config.locales[locale.prefix]?.ietf ?? '';\n    const text = createTag('p', { class: 'locale-text', lang }, locale.text);\n    wrapper.append(text);\n  });\n  fragment.append(wrapper);\n  return fragment;\n}\n\nfunction buildLinks(locales, config, createTag) {\n  const fragment = new DocumentFragment();\n  const wrapper = createTag('div', { class: 'link-wrapper' });\n  locales.forEach((locale) => {\n    const lang = config.locales[locale.prefix]?.ietf ?? '';\n    const link = createTag('a', { class: 'locale-link', lang, href: locale.url }, locale.button);\n    const para = createTag('p', { class: 'locale-link-wrapper' }, link);\n    wrapper.append(para);\n    link.addEventListener('click', () => {\n      const modPrefix = locale.prefix || 'us';\n      // set cookie so legacy code on adobecom still works properly.\n      document.cookie = `international=${modPrefix};path=/`;\n      sessionStorage.setItem('international', modPrefix);\n      link.closest('.dialog-modal').dispatchEvent(new Event('closeModal'));\n    });\n  });\n  fragment.append(wrapper);\n  return fragment;\n}\n\nfunction getCodes(data) {\n  return data.akamaiCodes.split(',').map((a) => a.toLowerCase().trim());\n}\n\nfunction getMatches(data, suppliedCode) {\n  return data.reduce((rdx, locale) => {\n    const localeCodes = getCodes(locale);\n    if (localeCodes.some((code) => code === suppliedCode)) rdx.push(locale);\n    return rdx;\n  }, []);\n}\n\nasync function getDetails(currentPage, localeMatches, config, createTag, getMetadata) {\n  const availableLocales = await getAvailableLocales(localeMatches, config, getMetadata);\n\n  if (availableLocales && availableLocales.length > 0) {\n    currentPage.url = window.location.hash ? document.location.href : '#';\n    const imgUrl = `${config.miloLibs || config.codeRoot}/img/icons/Smock_GlobeOutline_18_N.svg`;\n    const worldIcon = createTag('img', { src: imgUrl, class: 'world-icon' });\n    const text = buildText([...availableLocales, currentPage], config, createTag);\n    const links = buildLinks([...availableLocales, currentPage], config, createTag);\n    const detailsFragment = new DocumentFragment();\n    detailsFragment.append(worldIcon, text, links);\n    return detailsFragment;\n  }\n  return null;\n}\n\nasync function showModal(details) {\n  const { getModal } = await import('../../blocks/modal/modal.js');\n  return getModal(null, { class: 'locale-modal', id: 'locale-modal', content: details, closeEvent: 'closeModal' });\n}\n\nexport default async function loadGeoRouting(config, createTag, getMetadata, geoDetails = {}) {\n  const { locale } = config;\n\n  const urlLocale = locale.prefix.replace('/', '');\n  const storedInter = sessionStorage.getItem('international') || getCookie('international');\n  const storedLocale = storedInter === 'us' ? '' : storedInter;\n\n  const urlGeoData = geoDetails.data?.find((d) => d.prefix === urlLocale);\n  if (!urlGeoData) return;\n\n  if (storedLocale || storedLocale === '') {\n    // Show modal when url and cookie disagree\n    if (urlLocale.split('_')[0] !== storedLocale.split('_')[0]) {\n      const localeMatches = geoDetails.data?.filter((d) => d.prefix === storedLocale);\n      const details = await getDetails(urlGeoData, localeMatches, config, createTag, getMetadata);\n      if (details) { await showModal(details); }\n    }\n    return;\n  }\n\n  // Show modal when derived countries from url locale and akamai disagree\n  const akamaiCode = await getAkamaiCode();\n  if (akamaiCode && !getCodes(urlGeoData).includes(akamaiCode)) {\n    const localeMatches = getMatches(geoDetails.data, akamaiCode);\n    const details = await getDetails(urlGeoData, localeMatches, config, createTag, getMetadata);\n    if (details) { await showModal(details); }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
