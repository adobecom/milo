var roll=function(){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};function t(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}var r=function(){return(r=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(r[i[o]]=e[i[o]])}return r}function o(e,t,r,i){return new(r||(r=Promise))((function(o,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}function n(e,t){var r,i,o,n,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}function s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,o,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function a(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}var c,u=function(){function e(){this.data={},this.length=0}return e.prototype.clear=function(){this.data={},this.length=0},e.prototype.getItem=function(e){var t=this.data[e];return t||null},e.prototype.removeItem=function(e){return!!this.data[e]&&(delete this.data[e],--this.length,!0)},e.prototype.setItem=function(e,t){this.data[e]||++this.length,this.data[e]=t},e.prototype.key=function(e){throw new Error("Method not implemented. "+e)},e}();!function(e){e.LocalStorage="local",e.SessionStorage="session",e.MemoryStorage="memory"}(c||(c={}));var l,d="Authorization",p=new(function(){function e(){var e=this;this.logEnabled=!1,this.print=function(t,r){e.logEnabled&&t.apply(void 0,a(r))},this.assert=function(t,r){e.print(console.assert,[t,r])},this.assertCondition=function(t,r){t()||e.print(console.error,[r])},this.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.print(console.error,t)},this.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.print(console.warn,t)},this.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.print(console.info,t)}}return e.prototype.enableLogging=function(){this.logEnabled=!0},e.prototype.disableLogging=function(){this.logEnabled=!1},e}()),h=new(function(){function e(){this.memoryStorageInstance=null}return Object.defineProperty(e.prototype,"memoryStorage",{get:function(){return this.memoryStorageInstance||(this.memoryStorageInstance=new u),this.memoryStorageInstance},enumerable:!0,configurable:!0}),e.prototype.getStorageByName=function(e){var t=this.getStorageInstanceByName(e);return t&&this.verifyStorage(t)?t:this.memoryStorage},e.prototype.getStorageInstanceByName=function(e){if(e===c.MemoryStorage)return this.memoryStorage;try{return e===c.LocalStorage?window.localStorage:window.sessionStorage}catch(e){return p.warn("Please change your cookies settings in order to allow local data to be set"),null}},e.prototype.getAvailableStorage=function(){var e=this.getStorageByName(c.LocalStorage);return e instanceof u?this.getStorageByName(c.SessionStorage):e},e.prototype.verifyStorage=function(e){try{return e.setItem("test","true"),"true"===e.getItem("test")&&(e.removeItem("test"),!0)}catch(e){return!1}},e}()),f=function(){function e(e,t){void 0===t&&(t="adobeIMS"),this.storageInstance=null,this.nonceStorageKey="",this.nonceStorageKey="nonce"+t+e}return Object.defineProperty(e.prototype,"storage",{get:function(){return this.storageInstance||(this.storageInstance=h.getAvailableStorage()),this.storageInstance},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){if(window.csrf_verified=!1,!this.isStorageAvailable())return"";var t=e.generateNonce(),r=this.getNonceFromStorage()||{};return r=this.clearOlderNonceKeys(r),this.addNonceToObject(r,t),this.saveNonceValuesToStorage(r),t.value},e.prototype.addNonceToObject=function(e,t){e[t.value]=t.expiry},e.prototype.clearOlderNonceKeys=function(e,t){void 0===t&&(t=1296e4);var r=Date.now()-t;return Object.keys(e).forEach((function(t){parseInt(e[t])<r&&delete e[t]})),e},e.prototype.verify=function(e){if(!0===window.csrf_verified)return!0;if(window.csrf_verified=!0,!this.isStorageAvailable())return!0;var t=this.getNonceFromStorage();if(!t)return!1;var r=this.clearOlderNonceKeys(t),i=null!==(r[e]||null);return i&&this.clearNonceValueFromStorage(r,e),i},e.prototype.clearNonceValueFromStorage=function(e,t){delete e[t],this.saveNonceValuesToStorage(e)},e.prototype.getNonceFromStorage=function(){var e=this.storage.getItem(this.nonceStorageKey);return e?JSON.parse(e):null},e.prototype.saveNonceValuesToStorage=function(e){this.storage.setItem(this.nonceStorageKey,JSON.stringify(e))},e.prototype.isStorageAvailable=function(){return!(this.storage instanceof u)},e.cryptoRndomString=function(){if(!window.crypto)return"";var e=new Uint32Array(3);return window.crypto.getRandomValues(e),e.join("").substr(0,16)},e.randomString=function(){var t=e.cryptoRndomString();if(t)return t;for(var r="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<16;o++)r+=i.charAt(Math.floor(Math.random()*i.length));return r},e.generateNonce=function(){return{value:e.randomString(),expiry:(new Date).getTime().toString()}},e}(),v=new(function(){function e(){}return e.prototype.uriEncodeData=function(e){if("object"!=typeof e)return"";var t,r=[],i="";for(var o in e)void 0!==(t=e[o])&&(i=this.encodeValue(t),r.push(encodeURIComponent(o)+"="+i));return r.join("&")},e.prototype.encodeValue=function(e){return null===e?"null":"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(e)},e.prototype.replaceUrl=function(e){e&&window.location.replace(e)},e.prototype.sleep=function(e){return o(this,void 0,Promise,(function(){return n(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},e.prototype.replaceUrlAndWait=function(e,t){return o(this,void 0,Promise,(function(){return n(this,(function(r){switch(r.label){case 0:return e?(window.location.replace(e),[4,this.sleep(t)]):[2,Promise.resolve()];case 1:return r.sent(),[2,Promise.resolve()]}}))}))},e.prototype.setHrefUrl=function(e){e&&(window.location.href=e)},e.prototype.setHash=function(e){void 0===e&&(e=""),window.location.hash=e},e}());!function(e){e.STAGE="stg1",e.PROD="prod"}(l||(l={}));var m=function(){function e(e,t,r){void 0===e&&(e=!1),void 0===t&&(t=""),void 0===r&&(r=""),this.proxied=e,this.url=t,this.fallbackUrl=r}return e.computeEndpoint=function(t,r,i,o){var n,s;if(t){var a=i?e.THIRD_PARTY_DOMAINS_STAGE:e.THIRD_PARTY_DOMAINS_PROD;try{for(var c=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],i=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.keys(a)),u=c.next();!u.done;u=c.next()){var l=u.value;if(r===l||r.endsWith("."+l))return new e(!0,a[l],o)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(n)throw n.error}}}return new e(!1,o)},e.prototype.shouldFallbackToAdobe=function(e){return!!this.proxied&&("feature_disabled"===e.error&&"cdsc"===e.error_description)},e.THIRD_PARTY_DOMAINS_PROD={"behance.net":"https://sso.behance.net"},e.THIRD_PARTY_DOMAINS_STAGE={"s2stagehance.com":"https://sso.s2stagehance.com"},e}(),g=new(function(){function e(){this.baseUrlAdobe="",this.baseUrlServices="",this.checkTokenEndpoint=new m,this.jslibver="v2-v0.40.0-17-g241fb07"}return e.prototype.loadEnvironment=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r="");var i=e===l.STAGE;i?(this.baseUrlAdobe="https://ims-na1-stg1.adobelogin.com",this.baseUrlServices="https://adobeid-na1-stg1.services.adobe.com"):(this.baseUrlAdobe="https://ims-na1.adobelogin.com",this.baseUrlServices="https://adobeid-na1.services.adobe.com"),this.checkTokenEndpoint=m.computeEndpoint(t,r,i,this.baseUrlServices)},e}());function y(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}function k(e,t){if(null==e)return t;if(e===t)return e;if(!y(e))return e;var r=Object.assign({},e);return y(t)&&Object.keys(t).forEach((function(i){var o,n;y(t[i])?i in e?r[i]=k(e[i],t[i]):Object.assign(r,((o={})[i]=t[i],o)):Object.assign(r,((n={})[i]=t[i],n))})),r}var w=new(function(){function e(){this.getCustomApiParameters=function(e,t){return e[t]||{}}}return e.prototype.mergeExternalParameters=function(e,t,r){return k(this.getCustomApiParameters(t,r),e)},e.prototype.toJson=function(e){try{return"string"!=typeof e?e:JSON.parse(e)}catch(e){return null}},e}()),b=function(){function e(){}return e.getInitialRedirectUri=function(e,t){var r=e.redirect_uri||t||window.location.href,i="function"==typeof r?r():r,o=i.indexOf("from_ims");return-1===o?i:("#"===i[o-1]&&o--,i.substr(0,o))},e.createDefaultRedirectUrl=function(e,t,r,i){var o=this.getInitialRedirectUri(r,e),n=this.createOldHash(o);return n.indexOf("?")>0?n+"&client_id="+t+"&api="+i:n+"?client_id="+t+"&api="+i},e.createRedirectUrl=function(e,t,r,i,o){void 0===o&&(o="");var n=this.createDefaultRedirectUrl(e,t,r,i);(o=o||r.scope||"")&&(n=n+"&scope="+o);var s=r.reauth||"";return s&&(n=n+"&reauth="+s),n},e.createOldHash=function(e){var t=e.indexOf("#");return t<0?e+"#old_hash=&from_ims=true":e.substring(0,t)+"#old_hash="+e.substring(t+1)+"&from_ims=true"},e.mergeApiParamsWithExternalParams=function(e,t,r){return k(w.getCustomApiParameters(e,r),t)},e}(),S=function(){var e=this;this.composeRedirectUrl=function(e){var t=e.apiParameters,i=e.externalParameters,o=void 0===i?{}:i,n=e.adobeIdRedirectUri,s=void 0===n?"":n,a=e.clientId,c=e.locale,u=e.state,l=void 0===u?{}:u,d=e.scope,p=void 0===d?o.scope||t.scope||"":d,h=b.mergeApiParamsWithExternalParams(t,o,"authorize");l&&(h.state=k(h.state||{},l));var f=b.createRedirectUrl(s,a,h,"authorize",p),v=o.locale||c||"",m=e.response_type,y=void 0===m?h.response_type||"":m;return r(r({},h),{client_id:a,scope:p,locale:v,response_type:y,jslVersion:g.jslibver,redirect_uri:f})},this.createRedirectUrl=function(t){var r=e.composeRedirectUrl(t),i=v.uriEncodeData(r);return g.baseUrlAdobe+"/ims/authorize/v1?"+i}},I=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.signIn=function(e){var r=t.createRedirectUrl(e);v.setHrefUrl(r)},t.authorizeToken=function(e,r){var i=t.composeRedirectUrl(r);e&&(i.user_assertion=e,i.user_assertion_type="urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),t.createAuthorizeForm(i).submit()},t}return t(r,e),r.prototype.createAuthorizeForm=function(e){var t=g.baseUrlAdobe+"/ims/authorize/v1",r=document.createElement("form");r.style.display="none",r.setAttribute("method","post"),r.setAttribute("action",t);var i=null,o=null,n="";for(var s in e){if("object"==typeof(o=e[s])){if(0===Object.keys(o).length)continue;n=JSON.stringify(o)}else n=o;""!==n&&(i=this.createFormElement("input","text",s,n),r.appendChild(i))}return document.getElementsByTagName("body")[0].appendChild(r),r},r.prototype.createFormElement=function(e,t,r,i){var o=document.createElement(e);return o.setAttribute("type",t),o.setAttribute("name",r),o.setAttribute("value",i),o},r}(S),_=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/,T=["https://auth.services.adobe.com","https://auth-stg1.services.adobe.com","https://localhost.corp.adobe.com:9000"],P=new function(){var e=this;this.windowObjectReference=null,this.previousUrl="",this.openSignInWindow=function(t,r,i,o){e.onProcessLocation=o,e.allowOrigin=i.allowOrigin,e.timerId&&clearInterval(e.timerId),window.removeEventListener("message",e.receiveMessage),window.addEventListener("message",e.receiveMessage),e.broadcastChannel&&e.broadcastChannel.close(),e.broadcastChannel=new BroadcastChannel("imslib"),e.broadcastChannel.onmessage=e.receiveMessage;var n="popup=yes, width="+i.width+", height="+i.height+", top="+i.top+", left="+i.left;!e.windowObjectReference||e.windowObjectReference&&e.windowObjectReference.closed?e.windowObjectReference=window.open(t,i.title,n):e.previousUrl!==t?(e.windowObjectReference=window.open(t,i.title,n),e.windowObjectReference&&e.windowObjectReference.focus()):e.windowObjectReference.focus(),e.previousUrl=t},this.receiveMessage=function(t){if(a(T,[e.allowOrigin]).includes(t.origin)){try{if(!_.test(t.data))return void console.warn("refused to receive message containing unknown data format",t.data)}catch(e){return void console.error(e)}e.broadcastChannel&&e.broadcastChannel.close(),e.onProcessLocation&&e.onProcessLocation(t.data)}else console.warn("refused to receive message from origin not whitelisted",t.origin)}},R=function(e){function i(t,i){var o=e.call(this)||this;return o.signIn=function(e){e.state=r(r({},e.state),{imslibmodal:!0});var t=e.state.nonce,i=o.createRedirectUrl(e);P.openSignInWindow(i,t,o.popupSettings,o.onPopupMessage)},o.onPopupMessage=t,o.popupSettings=i,o}return t(i,e),i}(S),E=function(){function e(e,t){this.status=0,this.data="",this.status=e,this.data=this.toJson(t)}return e.prototype.toJson=function(e){try{return"string"!=typeof e?e:JSON.parse(e)}catch(t){return e}},e}(),A=new(function(){function e(){}return e.prototype.http=function(e){return new Promise((function(t,r){var i=new(0,window.XMLHttpRequest);"boolean"==typeof e.withCredentials?i.withCredentials=e.withCredentials:i.withCredentials=!0,"number"==typeof e.timeout&&(i.timeout=e.timeout),i.open(e.method,e.url,!0);var o;i.onload=function(){return this.status>=200&&this.status<300?t(new E(this.status,this.response)):r(new E(this.status,this.response))},i.onerror=function(){var e=new E(this.status,this.response);return r(e)},i.ontimeout=function(){var e=new E(0,"timeout");return r(e)},i.onabort=function(){var e=new E(0,"aborted");return r(e)},(o=e.headers)&&Object.keys(o).forEach((function(e){i.setRequestHeader(e,o[e])})),i.send(e.data)}))},e.prototype.post=function(e,t,r,i,o){return void 0===r&&(r={}),this.http({headers:r,method:"POST",url:e,data:t,withCredentials:i,timeout:o})},e.prototype.get=function(e,t,r,i){return void 0===t&&(t={}),this.http({headers:t,method:"GET",url:e,withCredentials:r,timeout:i})},e}()),O=function(){this.probe=function(e,t,r){if(void 0===r&&(r=2e3),!e||0===e.length)return Promise.resolve([]);for(var i={"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0,"X-IMS-CLIENTID":t},o="/ims/cdsc_probe?"+v.uriEncodeData({client_id:t}),n=[],s=[],a=function(t){var a=e[t]+o;s.push(A.post(a,{},i,!1,r).then((function(e){return 200==e.status&&n.push(t)})).catch((function(){})))},c=0;c<e.length;c++)a(c);return Promise.all(s).then((function(){return n}))}};function j(e,t){void 0===t&&(t=void 0);var i=e.apiParameters,o=e.externalParameters,n=e.adobeIdRedirectUri,s=void 0===n?"":n,a=e.clientId,c=b.mergeApiParamsWithExternalParams(i,o,"logout"),u=b.createDefaultRedirectUrl(s,a,c,"logout"),l=r(r({},c),{client_id:a,redirect_uri:u,jslVersion:g.jslibver});t&&(l=Object.assign(l,{probing_results:t}));var d=v.uriEncodeData(l),p=g.baseUrlAdobe+"/ims/logout/v1?"+d;v.replaceUrl(p)}var x,D,C=function(){this.signOut=function(e){var t=e.clientId;g.checkTokenEndpoint.proxied?(new O).probe([g.checkTokenEndpoint.url],t).then((function(t){j(e,t)})).catch((function(){j(e)})):j(e)}},U=function(e){void 0===e&&(e={}),this.title="Adobe ID",this.width=600,this.top=100,this.left=100;var t=e.title,r=void 0===t?"Adobe ID":t,i=e.width,o=void 0===i?600:i,n=e.height,s=void 0===n?700:n,a=e.top,c=void 0===a?100:a,u=e.left,l=void 0===u?100:u,d=e.allowedOrigin;this.title=r,this.width=o,this.height=s,this.top=c,this.left=l,this.allowOrigin=d},F=function(e){this.token="",this.sid="",this.expirems=0;var t=e.token,r=e.expirems;this.token=t,this.expirems=r};!function(e){e.force="force",e.check="check"}(x||(x={})),function(e){e.token="token",e.code="code"}(D||(D={}));var N,V=function(){this.appCode="",this.appVersion=""},M=function(){function e(){this.storage=h.getAvailableStorage()}return e.prototype.b64Uri=function(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},e.prototype.createCodeChallenge=function(e,t){var r=this;void 0===t&&(t=43);for(var i=window.msCrypto||window.crypto,o=this.b64Uri(Array.prototype.map.call(i.getRandomValues(new Uint8Array(t)),(function(e){return String.fromCharCode(e)})).join("")).substring(0,t),n=new Uint8Array(o.length),s=0;s<o.length;s++)n[s]=o.charCodeAt(s);var c=i.subtle.digest("SHA-256",n);return new Promise((function(t,i){window.CryptoOperation?(c.onerror=function(e){return i(e)},c.oncomplete=function(i){var n=new Uint8Array(i.target.result),s=r.b64Uri(String.fromCharCode.apply(String,a(n)));return t(r.saveVerifierAndReturn(e,{verifier:o,challenge:s}))}):c.then((function(i){var n=new Uint8Array(i),s=r.b64Uri(String.fromCharCode.apply(String,a(n)));return t(r.saveVerifierAndReturn(e,{verifier:o,challenge:s}))}))}))},e.prototype.saveVerifierAndReturn=function(e,t){var r=this.getVerifierValuesFromStorage(),i={verifier:t.verifier||"",expiry:(new Date).getTime().toString()};return r[e]=i,this.storage.setItem("verifiers",JSON.stringify(r)),Promise.resolve(t)},e.prototype.getVerifierValuesFromStorage=function(){var e=this.storage.getItem("verifiers"),t=e?JSON.parse(e):{};return this.clearOlderVerifiers(t)},e.prototype.clearOlderVerifiers=function(e,t){void 0===t&&(t=1296e4);var r=Date.now()-t;return Object.keys(e).forEach((function(t){parseInt(e[t])<r&&delete e[t]})),e},e.prototype.getVerifierByKey=function(e){var t=this.getVerifierValuesFromStorage(),r=t?t[e]:{};return delete t[e],this.storage.setItem("verifiers",JSON.stringify(t)),r?r.verifier:""},e}(),H=function(){function e(e){void 0===e&&(e=null),this.analyticsParameters=new V,this.api_parameters={},this.locale="",this.scope="AdobeID",this.client_id="",this.environment=l.PROD,this.useLocalStorage=!1,this.alwaysRemoveTokenFromUrl=!1,this.onReady=null,this.onModalModeSignInComplete=null,this.proxiedCheckToken=!1;var t=e||window.adobeid;if(!t||!t.client_id)throw new Error("Please provide required adobeId, client_id information");var r=t.api_parameters,i=t.client_id,o=t.locale,n=t.scope,s=t.ijt,a=t.environment,c=void 0===a?l.PROD:a,u=t.redirect_uri,d=t.useLocalStorage,h=t.logsEnabled,f=t.onReady,v=t.rideRedirectUri,m=t.proxiedCheckToken;this.environment=c,this.api_parameters=r||{},this.client_id=i,this.locale=o||"en_US",this.scope=n?n.replace(/\s/gi,""):"",this.redirect_uri=u,this.ijt=s,this.useLocalStorage=d,h?p.enableLogging():p.disableLogging(),this.onReady=f||null,this.rideRedirectUri=v,this.proxiedCheckToken=m,this.fillAnalyticsParameters(t),g.loadEnvironment(c,m,window.location.hostname)}return e.prototype.fillAnalyticsParameters=function(e){var t=e.analytics,r=void 0===t?{}:t,i=r.appCode,o=void 0===i?"":i,n=r.appVersion,s=void 0===n?"":n,a=this.analyticsParameters;a.appCode=o,a.appVersion=s},e.prototype.createSocialProviderRedirectRequest=function(e,t,i,o,n){var s={idp_flow:"social.deep_link.web",provider_id:e},a=r(r({},t),s);return this.createRedirectRequest(a,i,o,n)},e.prototype.createReAuthenticateRedirectRequest=function(e,t,i,o,n){void 0===o&&(o=x.check),void 0===n&&(n=D.token);var s={reauth:o},a=r(r({},e),s);return this.createRedirectRequest(a,t,i,n)},e.prototype.createSignUpRedirectRequest=function(e,t,i){var o=r(r({},e),{idp_flow:"create_account"});return this.createRedirectRequest(o,t,i,D.token)},e.prototype.createRedirectRequest=function(e,t,r,i){var o=this,n=this,s=n.api_parameters,a=void 0===s?{}:s,c=n.client_id,u=n.redirect_uri,l=void 0===u?"":u,d=n.scope,p=n.locale,h=this.createRedirectState(t,r),f={adobeIdRedirectUri:l,apiParameters:a,clientId:c,externalParameters:e,scope:d,locale:p,response_type:i,state:h};return i===D.token?Promise.resolve(f):(new M).createCodeChallenge(r).then((function(i){e.code_challenge=i.challenge,e.code_challenge_method="S256";var n=o.createRedirectState(t,r);return f.state=n,Promise.resolve(f)}))},e.prototype.createRedirectState=function(e,t){var r=this.analyticsParameters,i=r.appCode,o=void 0===i?"":i,n=r.appVersion,s=void 0===n?"":n,a=void 0===e?{}:{context:e};return o&&(a.ac=o),s&&(a.av=s),a.jslibver=g.jslibver,a.nonce=t,Object.keys(a).length?a:null},e.prototype.triggerOnReady=function(){this.onReady&&this.onReady(void 0)},e.prototype.computeRideRedirectUri=function(e){return this.rideRedirectUri?"string"==typeof this.rideRedirectUri?"DEFAULT"===this.rideRedirectUri?null:this.rideRedirectUri:this.rideRedirectUri(e):window.location.href},e}(),L=function(e){function i(t){void 0===t&&(t=null);var r=e.call(this,t)||this;r.onAccessTokenHasExpired=null,r.onAccessToken=null,r.onReauthAccessToken=null,r.onError=null,r.handlers={triggerOnAccessToken:function(e){r.onAccessToken&&r.onAccessToken(e)},triggerOnReauthAccessToken:function(e){r.onReauthAccessToken&&r.onReauthAccessToken(e)},triggerOnAccessTokenHasExpired:function(){r.onAccessTokenHasExpired&&r.onAccessTokenHasExpired()},triggerOnReady:function(e){void 0===e&&(e=null),r.onReady&&r.onReady(e)},triggerOnError:function(e,t){r.onError&&r.onError(e,t)}};var i=t||window.adobeid;if(!i||!i.client_id)throw new Error("Please provide required adobeId, client_id information");var o=i.standalone,n=i.autoValidateToken,s=i.modalSettings,a=void 0===s?{}:s,c=i.modalMode,u=void 0!==c&&c,l=i.onAccessToken,d=i.onReauthAccessToken,p=i.onAccessTokenHasExpired,h=i.onReady,f=i.onError,v=i.overrideErrorHandler,m=i.onModalModeSignInComplete;return o&&o.token&&(r.standalone=new F(o)),r.modalSettings=new U(a),r.modalMode=u,r.autoValidateToken=!!n,r.onAccessToken=l||null,r.onReauthAccessToken=d||null,r.onAccessTokenHasExpired=p||null,r.onReady=h||null,r.onError=f||null,r.overrideErrorHandler=v,r.onModalModeSignInComplete=m,r}return t(i,e),i.prototype.createSocialProviderRedirectRequest=function(e,t,i,o,n){void 0===n&&(n=D.token);var s={idp_flow:"social.deep_link.web",provider_id:e},a=r(r({},t),s);return this.createRedirectRequest(a,i,o,n)},i.prototype.createReAuthenticateRedirectRequest=function(e,t,i,o,n){void 0===o&&(o=x.check),void 0===n&&(n=D.token);var s={reauth:o},a=r(r({},e),s);return this.createRedirectRequest(a,t,i,n)},i.prototype.createSignUpRedirectRequest=function(e,t,i,o){void 0===o&&(o=D.token);var n=r(r({},e),{idp_flow:"create_account"});return this.createRedirectRequest(n,t,i,o)},i}(H),z=new(function(){function e(){var e=this;this.DEBOUNCE_TIME=1e3,this.cache={},this.storeApiResponse=function(t,r,i){void 0===t&&(t=""),void 0===r&&(r=""),e.cacheApiResponse(t,r,i)}}return e.prototype.getCachedApiResponse=function(e,t){void 0===t&&(t="");var r="string"==typeof t?t:JSON.stringify(t),i=this.cache[e];if(!i)return null;var o=i[r];return o?o.data:null},e.prototype.cacheApiResponse=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t="");var o=this.cache[e];o||(o={},this.cache[e]=o);var n=this.createClearCachedDataTimer(e,t);o[t]={timerId:n,data:r({},i)}},e.prototype.createClearCachedDataTimer=function(e,t){var r=this;return setTimeout((function(){var i=r.cache[e]||{},o=i[t];o&&o&&o.timerId&&(clearTimeout(o.timerId),delete i[t])}),this.DEBOUNCE_TIME)},e}()),q=function(e,t,r){void 0===r&&(r=!1),this.jump="",this.code=e,this.jump=t,this.isPbaExpiredIdleSessionWorkaround=r},J=function(e){var t=e.error,r=e.retryAfter,i=void 0===r?0:r,o=e.message,n=void 0===o?"":o;this.error=t,this.retryAfter=i,this.message=n},K=new(function(){function e(){this.adobeIdThinData=null}return e.prototype.verify=function(e,t){void 0===t&&(t="");var r=e.status,i=e.data;if(!r)return new J({error:"networkError",message:i||""});if(401==r)return new J({error:"unauthorized"});var o=this.parseTokenResponseForRideErrors(i,t);return o||(409==r?i:429==r?new J({error:"rate_limited",retryAfter:i.retryAfter?parseInt(i.retryAfter):10}):r.toString().match(/5\d{2}/g)?new J({error:"server_error"}):null)},e.prototype.parseTokenResponseForRideErrors=function(e,t){if(!e)return null;var r=e.error,i=e.jump;if(!r)return null;if(!(0===r.indexOf("ride_")))return"token_expired"===r&&t.indexOf("check/v6/token")>=0?new q("ride_pba_idle_session","",!0):null;var o=this.addRedirectUriToJump(r,i);return new q(r,o)},e.prototype.addRedirectUriToJump=function(e,t){if(!t||"string"!=typeof t)return"";var r=t;this.adobeIdThinData||(this.adobeIdThinData=new H);var i=this.adobeIdThinData.computeRideRedirectUri(e);if(!i||0===i.length)return r;try{var o=new URL(r);return o.searchParams.append("redirect_uri",i),o.toString()}catch(e){return r}},e.prototype.isUnauthorizedException=function(e){var t=e.status;return 401===(void 0===t?0:t)},e}()),B=new(function(){function e(){this.triggerOnError=null}return e.prototype.post=function(e,t,r){var i=this;void 0===r&&(r={});var o=z.getCachedApiResponse(e,t);if(o){var n=o.status,s=o.data;return 200===n?Promise.resolve(s):Promise.reject(s)}return A.post(e,t,r).then((function(r){return i.storeApiResponse(e,JSON.stringify(t),r)})).catch((function(r){return i.verifyError(e,JSON.stringify(t),r)}))},e.prototype.get=function(e,t){var r=this;void 0===t&&(t={});var i=z.getCachedApiResponse(e);if(i){var o=i.status,n=i.data;return 200===o?Promise.resolve(n):Promise.reject(n)}return A.get(e,t).then((function(t){return r.storeApiResponse(e,"",t)})).catch((function(t){return r.verifyError(e,"",t)}))},e.prototype.verifyError=function(e,t,r){this.storeApiResponse(e,t,r);var i=K.verify(r,e);return Promise.reject(i||r.data)},e.prototype.storeApiResponse=function(e,t,r){return void 0===t&&(t=""),z.storeApiResponse(e,t,r),Promise.resolve(r.data)},e}()),W=function(){function e(e){void 0===e&&(e={}),this.CONTENT_FORM_ENCODED="application/x-www-form-urlencoded;charset=utf-8",this.apiParameters=e}return e.prototype.validateToken=function(e){var t=e.token,i=e.client_id,o=v.uriEncodeData(r(r({},w.getCustomApiParameters(this.apiParameters,"validate_token")),{type:"access_token",client_id:i,token:t})),n=g.baseUrlAdobe+"/ims/validate_token/v1?jslVersion="+g.jslibver,s=this.formEncoded();return this.addClientIdInHeader(i,s),B.post(n,o,s)},e.prototype.getProfile=function(e){var t=e.token,i=e.client_id,o=r({},w.getCustomApiParameters(this.apiParameters,"profile")),n=this.createAuthorizationHeader(t);this.addClientIdInHeader(i,n);var s=v.uriEncodeData(r({client_id:i},o)),a=g.baseUrlAdobe+"/ims/profile/v1?"+s+"&jslVersion="+g.jslibver;return B.get(a,n)},e.prototype.getUserInfo=function(e){var t=e.token,i=e.client_id,o=r({},w.getCustomApiParameters(this.apiParameters,"userinfo")),n=this.createAuthorizationHeader(t);this.addClientIdInHeader(i,n);var s=v.uriEncodeData(r({client_id:i},o)),a=g.baseUrlAdobe+"/ims/userinfo/v1?"+s+"&jslVersion="+g.jslibver;return B.get(a,n)},e.prototype.logoutToken=function(e){var t=e.client_id,i=e.token,o=r({},w.getCustomApiParameters(this.apiParameters,"logout_token")),n=g.baseUrlServices+"/ims/logout/v1?jslVersion="+g.jslibver,s=this.addClientIdInHeader(t);return B.post(n,r({client_id:t,access_token:i},o),s)},e.prototype.checkStatus=function(){var e=g.baseUrlServices+"/ims/check/v1/status";return B.get(e)},e.prototype.checkToken=function(e,t,i){var o=e.client_id,n=e.scope,s=r({},w.mergeExternalParameters(t,this.apiParameters,"check_token")),a=r(r({},s),{client_id:o,scope:n});return i&&(a.user_id=i),this.callCheckToken(v.uriEncodeData(a),o,"/check/v6/token?jslVersion="+g.jslibver)},e.prototype.switchProfile=function(e,t,i){void 0===i&&(i="");var o=e.client_id,n=e.scope,s=void 0===n?"":n,a=r({},w.mergeExternalParameters(t,this.apiParameters,"check_token")),c=v.uriEncodeData(r(r({},a),{client_id:o,scope:s,user_id:i}));return this.callCheckToken(c,o,"/check/v6/token?jslVersion="+g.jslibver)},e.prototype.listSocialProviders=function(e){var t=e.client_id,i=r({},w.getCustomApiParameters(this.apiParameters,"providers")),o=v.uriEncodeData(r({client_id:t},i)),n=g.baseUrlServices+"/ims/social/v1/providers?"+o+"&jslVersion="+g.jslibver,s=this.addClientIdInHeader(t);return B.get(n,s)},e.prototype.exchangeIjt=function(e,t){var i=e.client_id,o=r({},w.getCustomApiParameters(this.apiParameters,"ijt")),n=g.baseUrlServices+"/ims/jump/implicit/"+t,s=v.uriEncodeData(r({client_id:i},o)),a=n+"?"+s+"&jslVersion="+g.jslibver;a.length>2048&&(delete o.redirect_uri,a=n+"?"+(s=v.uriEncodeData(o)));var c=this.addClientIdInHeader(i);return B.get(a,c)},e.prototype.avatarUrl=function(e){return g.baseUrlAdobe+"/ims/avatar/download/"+e},e.prototype.getReleaseFlags=function(e){var t=e.token,i=e.client_id,o=r({},w.getCustomApiParameters(this.apiParameters,"fg_value")),n=this.createAuthorizationHeader(t);this.addClientIdInHeader(i,n);var s=v.uriEncodeData(r({client_id:i},o)),a=g.baseUrlAdobe+"/ims/fg/value/v1?"+s+"&jslVersion="+g.jslibver;return B.get(a,n)},e.prototype.getTransitoryAuthorizationCode=function(e,t,i){void 0===t&&(t={});var o=r({},w.mergeExternalParameters(t,this.apiParameters,"check_token")),n=v.uriEncodeData(r(r({},o),e));return this.callCheckToken(n,i,"/check/v6/token?client_id="+i+"&jslVersion="+g.jslibver)},e.prototype.getTokenFromCode=function(e,t){void 0===t&&(t={});var i=r({},w.mergeExternalParameters(t,this.apiParameters,"token"));i.grant_type="authorization_code",delete e.other;var o=g.baseUrlServices+"/ims/token/v3?jslVersion="+g.jslibver,n=v.uriEncodeData(r(r({},i),e)),s=this.formEncoded();return this.addClientIdInHeader(e.client_id,s),B.post(o,n,s)},e.prototype.jumpToken=function(e,t,i){void 0===t&&(t={});var o=r({},w.mergeExternalParameters(t,this.apiParameters,"jumptoken")),n=g.baseUrlServices+"/ims/jumptoken/v1?client_id="+i+"&jslVersion="+g.jslibver,s=v.uriEncodeData(r(r({},o),e)),a=this.formEncoded();return this.addClientIdInHeader(i,a),B.post(n,s,a)},e.prototype.socialHeadlessSignIn=function(e,t){void 0===t&&(t={});var i=r({},w.mergeExternalParameters(t,this.apiParameters,"jumptoken")),o=g.baseUrlServices+"/ims/social/v2/native?jslVersion="+g.jslibver,n=v.uriEncodeData(r(r(r({},i),e),{response_type:"implicit_jump"}));return B.post(o,n,this.formEncoded())},e.prototype.createAuthorizationHeader=function(e){var t={};return e&&(t[d]="Bearer "+e),t},e.prototype.formEncoded=function(e){return void 0===e&&(e={}),e["content-type"]=this.CONTENT_FORM_ENCODED,e},e.prototype.addClientIdInHeader=function(e,t){return void 0===t&&(t={}),t.client_id=e,t},e.prototype.callCheckToken=function(e,t,r){var i=this.formEncoded();return this.addClientIdInHeader(t,i),B.post(g.checkTokenEndpoint.url+"/ims"+r,e,i).catch((function(t){if(!g.checkTokenEndpoint.shouldFallbackToAdobe(t))throw t;return B.post(g.checkTokenEndpoint.fallbackUrl+"/ims"+r,e,i)}))},e}();!function(e){e.INITIALIZE_ERROR="initialize_error",e.HTTP="http",e.FRAGMENT="fragment",e.CSRF="csrf",e.NOT_ALLOWED="not_allowed",e.PROFILE_EXCEPTION="profile_exception",e.TOKEN_EXPIRED="token_expired",e.SOCIAL_PROVIDERS="SOCIAL_PROVIDERS",e.RIDE_EXCEPTION="ride_exception"}(N||(N={}));var G=function(e){this.message=null,this.errorType=N.PROFILE_EXCEPTION,this.message=e};function X(e){return e.split(",").sort().join(",")}var Z,Y=function(){function e(e){this.profileServiceRequest=e,this.storage=h.getStorageByName(c.SessionStorage)}return e.prototype.getProfile=function(e){var t=this,r=this.profileServiceRequest,i=r.clientId,o=r.imsApis,n=this.getProfileFromStorage();return n?Promise.resolve(n):o.getProfile({client_id:i,token:e}).then((function(e){if(!e)throw new G("NO profile response");if(0===Object.keys(e).length)throw new G("NO profile value");return t.saveProfileToStorage(e),Promise.resolve(e)})).catch((function(e){return e instanceof J?Promise.reject(e):(t.removeProfile(),Promise.reject(e))}))},e.prototype.getProfileStorageKey=function(){var e=this.profileServiceRequest;return"adobeid_ims_profile/"+e.clientId+"/"+!1+"/"+X(e.scope)},e.prototype.getProfileFromStorage=function(){var e=this.getProfileStorageKey(),t=this.storage.getItem(e);return t&&JSON.parse(t)},e.prototype.saveProfileToStorage=function(e){var t=this.getProfileStorageKey();this.storage.setItem(t,JSON.stringify(e))},e.prototype.removeProfile=function(){var e=this.getProfileStorageKey();this.storage.removeItem(e)},e.prototype.removeProfileIfOtherUser=function(e){if(e){var t=this.getProfileFromStorage();t&&t.userId!==e&&this.removeProfile()}},e}(),Q=function(){function e(e,t){var r=this;this.REAUTH_SCOPE="reauthenticated",this.valid=!1,this.isReauth=function(){return r.scope.indexOf(r.REAUTH_SCOPE)>=0},this.client_id="",this.scope="",this.expire=new Date,this.user_id="",this.tokenValue="",this.sid="",this.state=null,this.fromFragment=!1,this.impersonatorId="",this.isImpersonatedSession=!1;var i=e.valid,o=e.tokenValue,n=e.access_token,s=e.state,a=e.other,c=o||n,u=this.parseJwt(c);if(!u)throw new Error("token cannot be decoded "+c);this.state=w.toJson(s);var l=u.client_id,d=u.user_id,p=u.scope,h=u.sid,f=u.imp_id,v=u.imp_sid,m=u.pba;this.client_id=l,this.expire=t,this.user_id=d,this.scope=p,this.valid=i,this.tokenValue=c,this.sid=h,this.other=a,this.impersonatorId=f||"",this.isImpersonatedSession=!!v,this.pbaSatisfiedPolicies=m&&m.split(",")||[]}return e.prototype.parseJwt=function(e){if(!e)return null;try{return JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")))}catch(t){return p.error("error on decoding token ",e,t),null}},e.prototype.validate=function(e,t){var r,i,o,n=this.valid,s=this.client_id,a=this.scope,c=this.expire;return c<new Date?(p.error("token invalid  --\x3e expires_at",c),!1):null==n||n?s!==e?(p.error("token invalid  --\x3e client id",s,e),!1):(r=t,o=(null==(i=a)?void 0:i.split(","))||[],!!((null==r?void 0:r.split(","))||[]).every((function(e){return o.includes(e)}))||(p.error("token invalid  --\x3e scope"," token scope =",a,"vs adobeIdScope =",t,"."),!1)):(p.error("token invalid  --\x3e valid"),!1)},e}(),$=new(function(){function e(){}return e.prototype.fragmentToObject=function(e){var t=this.getHashFromURL(e);if(!t)return null;var r=this.processHashUrl(t),i=this.getOldHash(r),o=i?r.slice(r.indexOf("old_hash")):r,n=this.removeOldHash(o),s=this.getQueryParamsAsMap(n);i&&(s.old_hash=i);var a=s.state;return a&&(s.state=w.toJson(a)),s},e.prototype.getOldHash=function(e){if(!e)return"";var t=e.match("old_hash=(.*?)&from_ims=true");return t?t[1]:""},e.prototype.removeOldHash=function(e){return e?e.replace(/old_hash=(.*?)&from_ims=true/gi,"from_ims=true"):e},e.prototype.removeAccessToken=function(e){return void 0===e&&(e=window.location.hash),!e&&e.length<1?e:e.startsWith("#")?"#"+this.removeAccessToken(e.substring(1)):e.replace(/(^access_token=[^&]+&?)|(&access_token=[^&]+)/g,"")},e.prototype.getHashFromURL=function(e){void 0===e&&(e=window.location.href);var t=e.indexOf("#");return-1!==t?e.substring(t+1):""},e.prototype.getQueryParamsAsMap=function(e){if(!e)return{};var t={};return(e=e.replace(/^(#\/|\/|#|\?|&)/,"")).split("&").forEach((function(e){if(e.length){var r=e.split("=");t[r[0]]=decodeURIComponent(r[1])}})),t},e.prototype.processHashUrl=function(e){return e.replace("?error","#error").replace(/#/gi,"&").replace("from_ims=true?","from_ims=true&")},e}()),ee=function(e,t){this.message="",this.type="",this.type=e,this.message=t};!function(e){e.FRAGMENT="fragment",e.CSRF="csrf",e.NOT_AUTHORIZE="not_authorize",e.API_NOT_ALLOWED="not_allowed",e.LOGOUT="logout"}(Z||(Z={}));var te=function(e,t){this.profile=null,this.tokenFields=e,this.profile=t},re=function(e){this.exception=null,this.exception=e},ie=function(e){this.client_id="",this.scope="",this.code="",this.state=null,this.code_verifier="",this.other=null;var t=e.code,r=e.state,o=e.client_id,n=e.scope,s=e.verifier,a=i(e,["code","state","client_id","scope","verifier"]);this.state=r,this.client_id=o,this.code=t,this.scope=n,this.code_verifier=s,this.other=a},oe=function(e){this.wndRedirectPropName="",this.wndRedirectPropName=e},ne="abcdefghijklmnopqrstuvwxyz234567".split("").reduce((function(e,t,r){return e[t]=r,e}),{"=":0}),se=function(e){return function(e,t,r){var i=t-r.length;return i>0&&(r=new Array(i+1).join(e)+r),r}("0",5,e.toString(2))},ae=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("Data is not a string");var r=e.toLowerCase().split("");!function(e){if(e.length%8!=0)throw new Error("Data length is not a multiple of 8");e.forEach((function(e){if(!(e in ne))throw new Error("Unknown encoded character "+e)}));var t=!1;e.forEach((function(e){if("="!==e&&t)throw new Error("Found padding char in the middle of the string");"="===e&&(t=!0)}))}(r);var i=function(e){for(var t=e.length-1,r=0;"="===e[t];)++r,--t;return r}(r),o=[];r.forEach((function(e){o.push(se(ne[e]))}));var n=o.join("");return i>0&&(n=n.slice(0,-5*i)),n.length%8!=0&&(n=n.slice(0,n.length%8*-1)),t?function(e){var t="";if(e.length%8!=0)throw new Error("Length must be a multiple of 8");for(var r=0,i=e.length;r<i;r+=8){t+=e.slice(r,r+8).split("").reverse().join("")}return t}(n):n},ce=["authorize","check_token"],ue=function(){function e(e,t){var r=this;this.getTokenAndProfile=function(e){void 0===e&&(e={});var t=r.getTokenFields();return t instanceof oe?Promise.reject(t):t instanceof ee?Promise.reject(t):t instanceof ie?r.tokenServiceRequest.imsApis.getTokenFromCode(t,e).then((function(e){var r=e.access_token,o=e.state,n=e.expires_in,s=e.scope,a=void 0===s?"":s,c=i(e,["access_token","state","expires_in","scope"]),u=new Q({scope:a,tokenValue:r,valid:!0,state:o,other:t.other},new Date((new Date).getTime()+parseFloat(n)));return Promise.resolve(new te(u,c))})):t instanceof Q?t.fromFragment||!r.tokenServiceRequest.autoValidateToken?Promise.resolve(new te(t,null)):r.callValidateTokenApi(t.tokenValue).then((function(){return new te(t,null)})).catch((function(){return r.callRefreshToken(e)})):r.callRefreshToken(e)};var o=e.useLocalStorage;this.csrfService=t,this.tokenServiceRequest=e,this.storage=h.getStorageByName(o?c.LocalStorage:c.SessionStorage)}return e.prototype.getTokenFields=function(){var e=this.tokenServiceRequest,t=e.clientId,r=e.scope,i=this.getTokenFromFragment();return i instanceof oe?i:i instanceof ee?i:i instanceof ie?i:i&&i.validate(t,r)?(i.fromFragment=!0,this.addTokenToStorage(i),i):this.getTokenFieldsFromStorage()},e.prototype.validateToken=function(){var e=this.getTokenFieldsFromStorage();return e?this.callValidateTokenApi(e.tokenValue):Promise.reject(null)},e.prototype.getReleaseFlags=function(){var e=this.tokenServiceRequest,t=e.clientId,r=e.imsApis,i=this.getTokenFieldsFromStorage();return i?r.getReleaseFlags({token:i.tokenValue,client_id:t}):Promise.reject(null)},e.prototype.getDecodedReleaseFlags=function(){return this.getReleaseFlags().then((function(e){return ae(e.releaseFlags,!0)}))},e.prototype.callValidateTokenApi=function(e){var t=this,i=this.tokenServiceRequest,o=i.clientId,n=i.scope;return i.imsApis.validateToken({client_id:o,token:e}).then((function(i){p.info("validateToken response",i);var s=new Q(r(r({},i),{tokenValue:e}),new Date(parseFloat(i.expires_at)));if(s.validate(o,n))return t.addTokenToStorage(s),Promise.resolve(s);throw new Error("could not validate tokenFields")})).catch((function(e){return p.error("validateToken response",e),e instanceof J?Promise.reject(e):(t.removeTokenFromLocalStorage(),Promise.reject(e))}))},e.prototype.getTokenFromFragment=function(e){var t=$.fragmentToObject(e);if(!t)return null;var o=t.access_token,n=t.scope,s=t.error,a=t.api,c=t.state,u=void 0===c?{}:c,l=t.expires_in,d=t.client_id,p=t.code,h=void 0===p?"":p,f=i(t,["access_token","scope","error","api","state","expires_in","client_id","code"]),v=u||{},m=v.imslibmodal,g=v.nonce;if(!0===m)return new oe(g);if("logout"===a)return new ee(Z.LOGOUT,"logout callback");if(!t.from_ims)return null;if(d!==this.tokenServiceRequest.clientId)return null;if(s)return new ee(Z.FRAGMENT,s);if(!ce.includes(a))return new ee(Z.API_NOT_ALLOWED,"api should be authorize or check token and "+a+" is used");if(!this.csrfService.verify(g))return new ee(Z.CSRF,"CSRF exception");if(h){var y=(new M).getVerifierByKey(g);if(!y)throw new Error("no verifier value has been found");return new ie(r(r({},t),{verifier:y}))}return o?new Q({client_id:d,scope:n,tokenValue:o,valid:!0,state:u,other:f},new Date((new Date).getTime()+parseFloat(l))):null},e.prototype.getItemFromStorage=function(e){return this.storage.getItem(e)},e.prototype.getTokenFieldsFromStorage=function(e){void 0===e&&(e=!1);var t=this.tokenServiceRequest,r=t.clientId,i=t.scope,o=this.getAccessTokenKey(e),n=this.getItemFromStorage(o);if(!n)return null;var s=JSON.parse(n),a=s.expire?new Date(Date.parse(s.expire)):new Date(s.expiresAtMilliseconds),c=new Q(s,a);return c.validate(r,i)?c:null},e.prototype.getAccessTokenKey=function(e){void 0===e&&(e=!1);var t=this.tokenServiceRequest;return"adobeid_ims_access_token/"+t.clientId+"/"+e+"/"+X(t.scope)},e.prototype.addTokenToStorage=function(e){if(e){var t=e.isReauth(),i=this.getAccessTokenKey(t),o=r({},e);o.state={},o.other="{}";var n=JSON.stringify(o);this.storage.setItem(i,n)}},e.prototype.removeTokenFromLocalStorage=function(){var e=this.getAccessTokenKey();this.storage.removeItem(e)},e.prototype.removeReauthTokenFromLocalStorage=function(){var e=this.getAccessTokenKey(!0);this.storage.removeItem(e)},e.prototype.refreshToken=function(e){var t=this;void 0===e&&(e={});var o=this.tokenServiceRequest,n=o.clientId,s=o.imsApis,a=o.scope,c=this.getTokenFieldsFromStorage(),u=c?c.user_id:"";return s.checkToken({client_id:n,scope:a},e,u).then((function(e){if(!e)throw new Error("refresh token --\x3e no response");var o=e.access_token,n=e.expires_in,s=e.token_type,a=e.error,c=e.error_description,u=void 0===c?"":c,l=e.sid,d=i(e,["access_token","expires_in","token_type","error","error_description","sid"]);if(a)throw new Error(a+" "+u);var p=Object.keys(d).length?d:null,h={token:o,expire:new Date(Date.now()+parseFloat(n)),token_type:s,sid:l},f=t.updateToken(h)||{},v={tokenInfo:r(r({},h),{impersonatorId:f.impersonatorId||"",isImpersonatedSession:f.isImpersonatedSession||!1,pbaSatisfiedPolicies:f.pbaSatisfiedPolicies||[]}),profile:p};return Promise.resolve(v)})).catch((function(e){return void 0===e&&(e={}),e instanceof J?Promise.reject(e):e instanceof q?Promise.reject(e):(t.removeTokenFromLocalStorage(),Promise.reject(new re(e)))}))},e.prototype.switchProfile=function(e,t){var o=this;void 0===t&&(t={});var n=this.tokenServiceRequest,s=n.clientId,a=n.imsApis,c=n.scope;return a.switchProfile({client_id:s,scope:c},t,e).then((function(e){if(!e)throw new Error("refresh token --\x3e no response");var t=e.access_token,n=e.expires_in,s=e.token_type,a=e.error,c=e.error_description,u=void 0===c?"":c,l=e.sid,d=i(e,["access_token","expires_in","token_type","error","error_description","sid"]);if(a)throw new Error(a+" "+u);var p=Object.keys(d).length?d:null,h={token:t,expire:new Date(Date.now()+parseFloat(n)),token_type:s,sid:l},f=o.updateToken(h)||{},v={tokenInfo:r(r({},h),{impersonatorId:f.impersonatorId||"",isImpersonatedSession:f.isImpersonatedSession||!1}),profile:p};return Promise.resolve(v)})).catch((function(e){return void 0===e&&(e={}),Promise.reject(e)}))},e.prototype.callRefreshToken=function(e){return void 0===e&&(e={}),this.refreshToken(e).then((function(e){var t=e.tokenInfo,r=t.token,i=t.expire,o=e.profile,n=new Q({valid:!0,tokenValue:r},i),s=new te(n,o);return Promise.resolve(s)})).catch((function(e){return Promise.reject(e)}))},e.prototype.updateToken=function(e){var t=e.token,r=e.expire,i=new Q({tokenValue:t},r);return i?(i.tokenValue=t,this.addTokenToStorage(i),i):null},e.prototype.purge=function(){this.removeTokenFromLocalStorage(),this.removeReauthTokenFromLocalStorage()},e.prototype.setStandAloneToken=function(e){var t=e.token,r=e.sid,i=e.expirems,o=void 0===i?-1:i,n=this.tokenServiceRequest,s=n.clientId,a=n.scope,c=new Date((new Date).getTime()+o);if(!new Q({valid:!0,tokenValue:t},c).validate(s,a))return!1;var u={expire:c,token:t,sid:r};return this.updateToken(u),!0},e.prototype.exchangeIjt=function(e){var t=this,r=this.tokenServiceRequest,i={client_id:r.clientId,scope:r.scope};return r.imsApis.exchangeIjt(i,e).then((function(e){var r=e.valid,i=e.access_token,o=e.expires_in,n=e.profile;if(!1===r)return Promise.reject(e);var s=new Date(Date.now()+1e3*parseFloat(o)),a=new Q({valid:!0,tokenValue:i},s);t.addTokenToStorage(a);var c=new te(a,n);return Promise.resolve(c)}))},e}(),le=["keyup","mousemove"],de=new(function(){function e(){var e=this;this.lastUserInteraction=Date.now(),this.userActive=!1,this.userInteractionHandler=function(){e.lastUserInteraction=Date.now(),e.userActive=!0},this.initializeDomEvents=function(){le.forEach((function(t){return window.addEventListener(t,e.userInteractionHandler)}))},this.clearDomEvents=function(){le.forEach((function(t){return window.removeEventListener(t,e.userInteractionHandler)}))}}return e.prototype.startAutoRefreshFlow=function(e){var t,r=this;if(e&&e.expire&&e.refreshTokenMethod){this.refreshParameters=e,this.refreshTimerId&&(p.info("Auto-refresh timer already set, clearing"),clearTimeout(this.refreshTimerId)),this.clearDomEvents(),this.initializeDomEvents();var i=this.fromNowToNMinutesBeforeDate(null===(t=this.refreshParameters)||void 0===t?void 0:t.expire,1);p.info("Auto-refresh timer will run after (seconds)",i/1e3),this.refreshTimerId=setTimeout((function(){var e;if(r.userActive){var t=Math.floor((Date.now()-r.lastUserInteraction)/1e3);null===(e=r.refreshParameters)||void 0===e||e.refreshTokenMethod({userInactiveSince:t},!0),p.info("Auto-refresh performed, user was inactive for (seconds)",t)}else p.info("Auto-refresh skipped, user was never active")}),i)}else p.info("Won't schedule token auto-refresh",!e,!e.expire,!e.refreshTokenMethod)},e.prototype.fromNowToNMinutesBeforeDate=function(e,t){var r=e.getTime()-Date.now()-6e4*t;return r<=0?6e4*t:r},e}()),pe=function(){function e(e,t){var i=this;void 0===e&&(e=null),this.initialized=!1,this.instanceKey="adobeIMS",this.onPopupMessage=function(e){if(e&&i.adobeIdData.onModalModeSignInComplete){var t=i.tokenService.getTokenFromFragment(e);if(t instanceof Q&&(i.tokenService.addTokenToStorage(t),i.adobeIdData.onModalModeSignInComplete(t)))return Promise.resolve()}return v.replaceUrl(e),i.initialize()},this.signIn=function(e,t,r){return void 0===e&&(e={}),void 0===r&&(r=D.token),o(i,void 0,Promise,(function(){var i,o,s,a,c;return n(this,(function(n){switch(n.label){case 0:return this.checkInitialized(),o=(i=this).adobeIdData,s=i.csrfService,a=s.initialize(),[4,o.createRedirectRequest(e,t,a,r)];case 1:return c=n.sent(),this.signInservice.signIn(c),[2,Promise.resolve()]}}))}))},this.authorizeToken=function(e,t,r,o){void 0===e&&(e=""),void 0===t&&(t={}),void 0===o&&(o=D.token);var n=i,s=n.adobeIdData,a=n.csrfService.initialize();return s.createRedirectRequest(t,r,a,o).then((function(t){(new I).authorizeToken(e,t)}))},this.reAuthenticate=function(e,t,r,o){void 0===e&&(e={}),void 0===t&&(t=x.check),void 0===o&&(o=D.token),i.checkInitialized();var n=i,s=n.adobeIdData,a=n.csrfService.initialize();return s.createReAuthenticateRedirectRequest(e,r,a,t,o).then((function(e){i.signInservice.signIn(e)}))},this.signInWithSocialProvider=function(e,t,r,o){if(void 0===t&&(t={}),void 0===o&&(o=D.token),i.checkInitialized(),!e)throw new Error("please provide the provider name");var n=i,s=n.adobeIdData,a=n.csrfService.initialize();s.createSocialProviderRedirectRequest(e,t,r,a,o).then((function(e){i.signInservice.signIn(e)}))},this.signOut=function(e){void 0===e&&(e={}),i.checkInitialized(),i.tokenService.purge(),i.profileService.removeProfile();var t=i.adobeIdData,r=t.api_parameters,o=void 0===r?{}:r,n=t.client_id,s={adobeIdRedirectUri:t.redirect_uri,apiParameters:o,clientId:n,externalParameters:e};(new C).signOut(s)},this.getTokenForPBAPolicy=function(e,t,r,o){var n;void 0===e&&(e=""),void 0===t&&(t=1e4),void 0===o&&(o={});var s=i.getAccessToken();if(s&&Date.now()+t<s.expire.getTime()&&(!e||(null===(n=s.pbaSatisfiedPolicies)||void 0===n?void 0:n.includes(e))))return Promise.resolve(s);var a=i,c=a.adobeIdData,u=a.csrfService.initialize();return o.state=c.createRedirectState(r,u),o.redirect_uri=b.createRedirectUrl(c.redirect_uri,c.client_id,o,"check_token",c.scope),e&&(o.pba_policy=e),i.refreshToken(o)},this.refreshToken=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=!1),!t&&e.userInactiveSince){var r=e.userInactiveSince,o=Date.now()-1e3*r;o>de.lastUserInteraction&&(de.lastUserInteraction=o)}return i.tokenService.refreshToken(e).then((function(e){return i.onTokenProfileReceived(e)})).catch((function(e){if(p.error("refresh token error",e),e instanceof J)return Promise.reject(e);var t=i.verifyRideErrorExceptionStrict(e);return t||(i.profileService.removeProfile(),i.onTokenExpired(),Promise.reject(e))}))},this.switchProfile=function(e,t){return void 0===t&&(t={}),e?i.tokenService.switchProfile(e,t).then((function(e){return i.onTokenProfileReceived(e)})).catch((function(e){return i.verifyRideErrorException(e)})):Promise.reject(new Error("Please provide the user id for switchProfile"))},this.executeErrorCallback=function(e){if(p.info("initialize exception ended",e),!e||e.type!==Z.LOGOUT){var t=i.adobeIdData.onError;t&&t(N.HTTP,"Initialization error")}},this.triggerOnImsInstance=function(e){var t=document.createEvent("CustomEvent"),r={clientId:i.adobeIdData.client_id,instance:e};t.initCustomEvent("onImsLibInstance",!1,!1,r),window.dispatchEvent(t)},this.processInitializeException=function(e){return void 0===e&&(e={}),p.warn("initialize",e),i.restoreHash(),Promise.reject(e)},this.verifyModalSignInEvent=function(e){return e instanceof oe?i.notifyParentAboutModalSignIn(e):Promise.reject(e)},this.verifyTokenExpiredException=function(e){return e instanceof re?(i.adobeIdData.handlers.triggerOnAccessTokenHasExpired(),Promise.resolve()):Promise.reject(e)},this.verifyRideErrorException=function(e){return o(i,void 0,Promise,(function(){return n(this,(function(t){switch(t.label){case 0:return e instanceof q?this.adobeIdData.overrideErrorHandler&&!this.adobeIdData.overrideErrorHandler(e)?[2,Promise.reject(e)]:e.isPbaExpiredIdleSessionWorkaround?[4,this.signIn()]:[3,2]:[3,4];case 1:return t.sent(),[3,4];case 2:return e.jump?[4,v.replaceUrlAndWait(e.jump,1e4)]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2,Promise.reject(e)]}}))}))},this.verifyRideErrorExceptionStrict=function(e){return e instanceof q?i.verifyRideErrorException(e):null},this.verifyCsrfException=function(e){var t=e.type;return t&&t===N.CSRF&&i.signOut(),Promise.reject(e)},this.processTokenResponse=function(e){var t=i.adobeIdData.handlers,r=e.tokenFields,o=e.profile,n=r.tokenValue,s=r.state,a=r.expire,c=r.sid,u=r.user_id,l=r.other,d=void 0===l?{}:l,h=r.impersonatorId,f=r.isImpersonatedSession,m=r.pbaSatisfiedPolicies;p.info("token",n),d.from_ims&&v.setHash(d.old_hash||""),i.profileService.removeProfileIfOtherUser(u);var g={token:n,expire:a,sid:c,impersonatorId:h,isImpersonatedSession:f,pbaSatisfiedPolicies:m};return r.isReauth()?t.triggerOnReauthAccessToken(g):i.tokenReceived(g),o&&i.profileService.saveProfileToStorage(o),Promise.resolve(s)},this.exchangeIjt=function(e){var t=i.adobeIdData.ijt;return e||t?i.tokenService.exchangeIjt(e||t).then((function(e){return e.profile?i.profileService.saveProfileToStorage(e.profile):i.profileService.removeProfile(),Promise.resolve(e)})):Promise.reject(new Error("please set the adobeid.ijt value"))},this.adobeIdData=new L(e),t&&(this.instanceKey=t);var s=this.adobeIdData,a=s.api_parameters,c=void 0===a?{}:a,u=s.client_id,l=s.scope,d=s.useLocalStorage,h=s.autoValidateToken,m=s.modalMode,g=s.modalSettings;this.imsApis=new W(c),this.csrfService=new f(u,this.instanceKey),this.serviceRequest={clientId:u,scope:l,imsApis:this.imsApis},this.tokenService=new ue(r(r({},this.serviceRequest),{useLocalStorage:d,autoValidateToken:h}),this.csrfService),this.profileService=new Y(this.serviceRequest),this.signInservice=m?new R(this.onPopupMessage,g):new I}return Object.defineProperty(e.prototype,"version",{get:function(){return g.jslibver},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adobeid",{get:function(){return r({},this.adobeIdData)},enumerable:!0,configurable:!0}),e.prototype.enableLogging=function(){p.enableLogging()},e.prototype.disableLogging=function(){p.disableLogging()},e.prototype.checkInitialized=function(){this.initialized},e.prototype.signUp=function(e,t){var r=this;void 0===e&&(e={}),this.checkInitialized();var i=this.adobeIdData,o=this.csrfService;if(!i)throw new Error("no adobeId on reAuthenticate");var n=o.initialize();return i.createSignUpRedirectRequest(e,t,n).then((function(e){r.signInservice.signIn(e)}))},e.prototype.isSignedInUser=function(){return!(!this.getAccessToken()&&!this.getReauthAccessToken())},e.prototype.getProfile=function(){var e=this,t=this.profileService.getProfileFromStorage();if(t)return Promise.resolve(t);var r=this.getAccessToken()||this.getReauthAccessToken();if(!r){return Promise.reject(new G("please login before getting the profile"))}return this.profileService.getProfile(r.token).then((function(e){return Promise.resolve(e)})).catch((function(t){return p.error("get profile exception ",t),t instanceof J?e.refreshToken().then((function(e){return Promise.resolve(e.profile)})):Promise.reject(new G(t.message||t))}))},e.prototype.avatarUrl=function(e){return this.imsApis.avatarUrl(e)},e.prototype.getReleaseFlags=function(e){return void 0===e&&(e=!1),e?this.tokenService.getDecodedReleaseFlags():this.tokenService.getReleaseFlags()},e.prototype.getAccessToken=function(){return this.getTokenFromStorage(!1)},e.prototype.getReauthAccessToken=function(){return this.getTokenFromStorage(!0)},e.prototype.getTokenFromStorage=function(e){var t=this.tokenService.getTokenFieldsFromStorage(e);return t?{token:t.tokenValue,expire:t.expire,sid:t.sid,impersonatorId:t.impersonatorId,isImpersonatedSession:t.isImpersonatedSession,pbaSatisfiedPolicies:t.pbaSatisfiedPolicies}:null},e.prototype.listSocialProviders=function(){var e=this;return new Promise((function(t,r){var i=e.adobeIdData.client_id;e.imsApis.listSocialProviders({client_id:i}).then((function(e){t(e)})).catch((function(e){r(e)}))}))},e.prototype.tokenReceived=function(e){this.adobeIdData.handlers.triggerOnAccessToken(e),de.startAutoRefreshFlow({expire:e.expire,refreshTokenMethod:this.refreshToken})},e.prototype.onTokenProfileReceived=function(e){var t=e.tokenInfo,r=e.profile;return p.info("token",t),this.tokenReceived(t),this.profileService.saveProfileToStorage(r),Promise.resolve(e)},e.prototype.validateToken=function(){var e=this;return this.tokenService.validateToken().then((function(){return Promise.resolve(!0)})).catch((function(t){return p.warn("validate token exception",t),t instanceof J?Promise.reject(!1):(e.profileService.removeProfile(),Promise.reject(!1))}))},e.prototype.onTokenExpired=function(){var e=this.adobeIdData.handlers;this.tokenService.purge(),e.triggerOnAccessTokenHasExpired()},e.prototype.setStandAloneToken=function(e){return this.tokenService.setStandAloneToken(e)},e.prototype.initialize=function(){var e=this,t=this.adobeIdData,r=t.handlers,i=t.standalone,o=t.ijt,n=t.alwaysRemoveTokenFromUrl,s=null;return i&&this.setStandAloneToken(i),(o?this.exchangeIjt:this.tokenService.getTokenAndProfile)().then(this.processTokenResponse,this.processError.apply(this)).then((function(e){s=e})).finally((function(){p.info("onReady initialization"),window.addEventListener("getImsLibInstance",(function(){e.triggerOnImsInstance(e)}),!1),n&&v.setHash($.removeAccessToken()),r.triggerOnReady(s?s.context:null),e.triggerOnImsInstance(e),e.initialized=!0}))},e.prototype.processError=function(){var e=this;return function(t){return e.verifyModalSignInEvent(t).catch(e.processInitializeException).catch(e.verifyTokenExpiredException).catch(e.verifyRideErrorException).catch(e.verifyCsrfException).catch(e.executeErrorCallback)}},e.prototype.notifyParentAboutModalSignIn=function(e){var t=window.location.href.replace("imslibmodal","wasmodal");if(window.opener)window.opener.postMessage(t,window.location.origin),window.close();else{var r=new BroadcastChannel("imslib");r.postMessage(t),r.close(),window.close()}return Promise.reject("popup")},e.prototype.restoreHash=function(){var e=$.fragmentToObject();e&&e.from_ims&&v.setHash(e.old_hash||"")},e.prototype.getTransitoryAuthorizationCode=function(e,t){return void 0===t&&(t={}),(e=e||{}).response_type=e.response_type||"code",e.target_client_id=e.target_client_id||this.adobeIdData.client_id,e.target_scope=e.target_scope||this.adobeIdData.scope,this.imsApis.getTransitoryAuthorizationCode(e,t,this.adobeIdData.client_id)},e.prototype.jumpToken=function(e,t){return void 0===t&&(t={}),e.target_client_id=e.target_client_id||this.adobeIdData.client_id,e.target_scope=e.target_scope||this.adobeIdData.scope,this.imsApis.jumpToken(e,t,this.adobeIdData.client_id)},e.prototype.getVerifierByKey=function(e){return(new M).getVerifierByKey(e)},e.prototype.socialHeadlessSignIn=function(e,t){return void 0===t&&(t={}),o(this,void 0,Promise,(function(){var r=this;return n(this,(function(i){return[2,this.imsApis.socialHeadlessSignIn(e,t).then((function(e){return r.exchangeIjt(e.token)})).catch((function(t){return"ride_AdobeID_social"===t.error&&r.signIn({idp_flow:"social.native",provider_id:e.provider_id,idp_token:e.idp_token}),Promise.reject(t)}))]}))}))},e}(),he=new(function(){function e(){this.createIMSLib=function(e,t){void 0===e&&(e=null),void 0===t&&(t="adobeIMS");var r=new pe(e,t);return window[t]=r,r}}return e.prototype.initAdobeIms=function(){window.adobeImsFactory={createIMSLib:this.createIMSLib};var e=window.adobeIMS||null;if(!e){var t=window.adobeid;if(!t||!t.client_id)return;(e=this.createIMSLib(t,"adobeIMS")).initialize()}},e}());return new(function(){function e(){he.initAdobeIms()}return e.prototype.initialize=function(){return!0},e}())}();
